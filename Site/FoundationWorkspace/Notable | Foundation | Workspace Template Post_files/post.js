/*!
 * jQuery UI 1.8.24
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
(function(a,d){a.ui=a.ui||{};if(a.ui.version){return}a.extend(a.ui,{version:"1.8.24",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(e,f){return typeof e==="number"?this.each(function(){var g=this;setTimeout(function(){a(g).focus();if(f){f.call(g)}},e)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;if((a.browser.msie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){e=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test(a.curCSS(this,"position",1))&&(/(auto|scroll)/).test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0)}else{e=this.parents().filter(function(){return(/(auto|scroll)/).test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0)}return(/fixed/).test(this.css("position"))||!e.length?a(document):e},zIndex:function(h){if(h!==d){return this.css("zIndex",h)}if(this.length){var f=a(this[0]),e,g;while(f.length&&f[0]!==document){e=f.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){g=parseInt(f.css("zIndex"),10);if(!isNaN(g)&&g!==0){return g}}f=f.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});if(!a("<a>").outerWidth(1).jquery){a.each(["Width","Height"],function(g,e){var f=e==="Width"?["Left","Right"]:["Top","Bottom"],h=e.toLowerCase(),k={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};function j(m,l,i,n){a.each(f,function(){l-=parseFloat(a.curCSS(m,"padding"+this,true))||0;if(i){l-=parseFloat(a.curCSS(m,"border"+this+"Width",true))||0}if(n){l-=parseFloat(a.curCSS(m,"margin"+this,true))||0}});return l}a.fn["inner"+e]=function(i){if(i===d){return k["inner"+e].call(this)}return this.each(function(){a(this).css(h,j(this,i)+"px")})};a.fn["outer"+e]=function(i,l){if(typeof i!=="number"){return k["outer"+e].call(this,i)}return this.each(function(){a(this).css(h,j(this,i,true,l)+"px")})}})}function c(g,e){var j=g.nodeName.toLowerCase();if("area"===j){var i=g.parentNode,h=i.name,f;if(!g.href||!h||i.nodeName.toLowerCase()!=="map"){return false}f=a("img[usemap=#"+h+"]")[0];return !!f&&b(f)}return(/input|select|textarea|button|object/.test(j)?!g.disabled:"a"==j?g.href||e:e)&&b(g)}function b(e){return !a(e).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(e){return function(f){return !!a.data(f,e)}}):function(g,f,e){return !!a.data(g,e[3])},focusable:function(e){return c(e,!isNaN(a.attr(e,"tabindex")))},tabbable:function(g){var e=a.attr(g,"tabindex"),f=isNaN(e);return(f||e>=0)&&c(g,!f)}});a(function(){var e=document.body,f=e.appendChild(f=document.createElement("div"));f.offsetHeight;a.extend(f.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});a.support.minHeight=f.offsetHeight===100;a.support.selectstart="onselectstart" in f;e.removeChild(f).style.display="none"});if(!a.curCSS){a.curCSS=a.css}a.extend(a.ui,{plugin:{add:function(f,g,j){var h=a.ui[f].prototype;for(var e in j){h.plugins[e]=h.plugins[e]||[];h.plugins[e].push([g,j[e]])}},call:function(e,g,f){var j=e.plugins[g];if(!j||!e.element[0].parentNode){return}for(var h=0;h<j.length;h++){if(e.options[j[h][0]]){j[h][1].apply(e.element,f)}}}},contains:function(f,e){return document.compareDocumentPosition?f.compareDocumentPosition(e)&16:f!==e&&f.contains(e)},hasScroll:function(h,f){if(a(h).css("overflow")==="hidden"){return false}var e=(f&&f==="left")?"scrollLeft":"scrollTop",g=false;if(h[e]>0){return true}h[e]=1;g=(h[e]>0);h[e]=0;return g},isOverAxis:function(f,e,g){return(f>e)&&(f<(e+g))},isOver:function(j,f,i,h,e,g){return a.ui.isOverAxis(j,i,e)&&a.ui.isOverAxis(f,h,g)}})})(jQuery);
/*!
 * jQuery UI Widget 1.8.24
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(b,d){if(b.cleanData){var c=b.cleanData;b.cleanData=function(f){for(var g=0,h;(h=f[g])!=null;g++){try{b(h).triggerHandler("remove")}catch(j){}}c(f)}}else{var a=b.fn.remove;b.fn.remove=function(e,f){return this.each(function(){if(!f){if(!e||b.filter(e,[this]).length){b("*",this).add([this]).each(function(){try{b(this).triggerHandler("remove")}catch(g){}})}}return a.call(b(this),e,f)})}}b.widget=function(f,h,e){var g=f.split(".")[0],j;f=f.split(".")[1];j=g+"-"+f;if(!e){e=h;h=b.Widget}b.expr[":"][j]=function(k){return !!b.data(k,f)};b[g]=b[g]||{};b[g][f]=function(k,l){if(arguments.length){this._createWidget(k,l)}};var i=new h();i.options=b.extend(true,{},i.options);b[g][f].prototype=b.extend(true,i,{namespace:g,widgetName:f,widgetEventPrefix:b[g][f].prototype.widgetEventPrefix||f,widgetBaseClass:j},e);b.widget.bridge(f,b[g][f])};b.widget.bridge=function(f,e){b.fn[f]=function(i){var g=typeof i==="string",h=Array.prototype.slice.call(arguments,1),j=this;i=!g&&h.length?b.extend.apply(null,[true,i].concat(h)):i;if(g&&i.charAt(0)==="_"){return j}if(g){this.each(function(){var k=b.data(this,f),l=k&&b.isFunction(k[i])?k[i].apply(k,h):k;if(l!==k&&l!==d){j=l;return false}})}else{this.each(function(){var k=b.data(this,f);if(k){k.option(i||{})._init()}else{b.data(this,f,new e(i,this))}})}return j}};b.Widget=function(e,f){if(arguments.length){this._createWidget(e,f)}};b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(f,g){b.data(g,this.widgetName,this);this.element=b(g);this.options=b.extend(true,{},this.options,this._getCreateOptions(),f);var e=this;this.element.bind("remove."+this.widgetName,function(){e.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return b.metadata&&b.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(f,g){var e=f;if(arguments.length===0){return b.extend({},this.options)}if(typeof f==="string"){if(g===d){return this.options[f]}e={};e[f]=g}this._setOptions(e);return this},_setOptions:function(f){var e=this;b.each(f,function(g,h){e._setOption(g,h)});return this},_setOption:function(e,f){this.options[e]=f;if(e==="disabled"){this.widget()[f?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",f)}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(e,f,g){var j,i,h=this.options[e];g=g||{};f=b.Event(f);f.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase();f.target=this.element[0];i=f.originalEvent;if(i){for(j in i){if(!(j in f)){f[j]=i[j]}}}this.element.trigger(f,g);return !(b.isFunction(h)&&h.call(this.element[0],f,g)===false||f.isDefaultPrevented())}}})(jQuery);
/*!
 * jQuery UI Mouse 1.8.24
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
(function(b,c){var a=false;b(document).mouseup(function(d){a=false});b.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var d=this;this.element.bind("mousedown."+this.widgetName,function(e){return d._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(true===b.data(e.target,d.widgetName+".preventClickEvent")){b.removeData(e.target,d.widgetName+".preventClickEvent");e.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function(f){if(a){return}(this._mouseStarted&&this._mouseUp(f));this._mouseDownEvent=f;var e=this,g=(f.which==1),d=(typeof this.options.cancel=="string"&&f.target.nodeName?b(f.target).closest(this.options.cancel).length:false);if(!g||d||!this._mouseCapture(f)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){e.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(f)&&this._mouseDelayMet(f)){this._mouseStarted=(this._mouseStart(f)!==false);if(!this._mouseStarted){f.preventDefault();return true}}if(true===b.data(f.target,this.widgetName+".preventClickEvent")){b.removeData(f.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(h){return e._mouseMove(h)};this._mouseUpDelegate=function(h){return e._mouseUp(h)};b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);f.preventDefault();a=true;return true},_mouseMove:function(d){if(b.browser.msie&&!(document.documentMode>=9)&&!d.button){return this._mouseUp(d)}if(this._mouseStarted){this._mouseDrag(d);return d.preventDefault()}if(this._mouseDistanceMet(d)&&this._mouseDelayMet(d)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,d)!==false);(this._mouseStarted?this._mouseDrag(d):this._mouseUp(d))}return !this._mouseStarted},_mouseUp:function(d){b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(d.target==this._mouseDownEvent.target){b.data(d.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(d)}return false},_mouseDistanceMet:function(d){return(Math.max(Math.abs(this._mouseDownEvent.pageX-d.pageX),Math.abs(this._mouseDownEvent.pageY-d.pageY))>=this.options.distance)},_mouseDelayMet:function(d){return this.mouseDelayMet},_mouseStart:function(d){},_mouseDrag:function(d){},_mouseStop:function(d){},_mouseCapture:function(d){return true}})})(jQuery);
/*!
 * jQuery UI Position 1.8.24
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */
(function(g,h){g.ui=g.ui||{};var d=/left|center|right/,e=/top|center|bottom/,a="center",f={},b=g.fn.position,c=g.fn.offset;g.fn.position=function(j){if(!j||!j.of){return b.apply(this,arguments)}j=g.extend({},j);var n=g(j.of),m=n[0],p=(j.collision||"flip").split(" "),o=j.offset?j.offset.split(" "):[0,0],l,i,k;if(m.nodeType===9){l=n.width();i=n.height();k={top:0,left:0}}else{if(m.setTimeout){l=n.width();i=n.height();k={top:n.scrollTop(),left:n.scrollLeft()}}else{if(m.preventDefault){j.at="left top";l=i=0;k={top:j.of.pageY,left:j.of.pageX}}else{l=n.outerWidth();i=n.outerHeight();k=n.offset()}}}g.each(["my","at"],function(){var q=(j[this]||"").split(" ");if(q.length===1){q=d.test(q[0])?q.concat([a]):e.test(q[0])?[a].concat(q):[a,a]}q[0]=d.test(q[0])?q[0]:a;q[1]=e.test(q[1])?q[1]:a;j[this]=q});if(p.length===1){p[1]=p[0]}o[0]=parseInt(o[0],10)||0;if(o.length===1){o[1]=o[0]}o[1]=parseInt(o[1],10)||0;if(j.at[0]==="right"){k.left+=l}else{if(j.at[0]===a){k.left+=l/2}}if(j.at[1]==="bottom"){k.top+=i}else{if(j.at[1]===a){k.top+=i/2}}k.left+=o[0];k.top+=o[1];return this.each(function(){var t=g(this),v=t.outerWidth(),s=t.outerHeight(),u=parseInt(g.curCSS(this,"marginLeft",true))||0,r=parseInt(g.curCSS(this,"marginTop",true))||0,x=v+u+(parseInt(g.curCSS(this,"marginRight",true))||0),y=s+r+(parseInt(g.curCSS(this,"marginBottom",true))||0),w=g.extend({},k),q;if(j.my[0]==="right"){w.left-=v}else{if(j.my[0]===a){w.left-=v/2}}if(j.my[1]==="bottom"){w.top-=s}else{if(j.my[1]===a){w.top-=s/2}}if(!f.fractions){w.left=Math.round(w.left);w.top=Math.round(w.top)}q={left:w.left-u,top:w.top-r};g.each(["left","top"],function(A,z){if(g.ui.position[p[A]]){g.ui.position[p[A]][z](w,{targetWidth:l,targetHeight:i,elemWidth:v,elemHeight:s,collisionPosition:q,collisionWidth:x,collisionHeight:y,offset:o,my:j.my,at:j.at})}});if(g.fn.bgiframe){t.bgiframe()}t.offset(g.extend(w,{using:j.using}))})};g.ui.position={fit:{left:function(i,j){var l=g(window),k=j.collisionPosition.left+j.collisionWidth-l.width()-l.scrollLeft();i.left=k>0?i.left-k:Math.max(i.left-j.collisionPosition.left,i.left)},top:function(i,j){var l=g(window),k=j.collisionPosition.top+j.collisionHeight-l.height()-l.scrollTop();i.top=k>0?i.top-k:Math.max(i.top-j.collisionPosition.top,i.top)}},flip:{left:function(j,l){if(l.at[0]===a){return}var n=g(window),m=l.collisionPosition.left+l.collisionWidth-n.width()-n.scrollLeft(),i=l.my[0]==="left"?-l.elemWidth:l.my[0]==="right"?l.elemWidth:0,k=l.at[0]==="left"?l.targetWidth:-l.targetWidth,o=-2*l.offset[0];j.left+=l.collisionPosition.left<0?i+k+o:m>0?i+k+o:0},top:function(j,l){if(l.at[1]===a){return}var n=g(window),m=l.collisionPosition.top+l.collisionHeight-n.height()-n.scrollTop(),i=l.my[1]==="top"?-l.elemHeight:l.my[1]==="bottom"?l.elemHeight:0,k=l.at[1]==="top"?l.targetHeight:-l.targetHeight,o=-2*l.offset[1];j.top+=l.collisionPosition.top<0?i+k+o:m>0?i+k+o:0}}};if(!g.offset.setOffset){g.offset.setOffset=function(m,j){if(/static/.test(g.curCSS(m,"position"))){m.style.position="relative"}var l=g(m),o=l.offset(),i=parseInt(g.curCSS(m,"top",true),10)||0,n=parseInt(g.curCSS(m,"left",true),10)||0,k={top:(j.top-o.top)+i,left:(j.left-o.left)+n};if("using" in j){j.using.call(m,k)}else{l.css(k)}};g.fn.offset=function(i){var j=this[0];if(!j||!j.ownerDocument){return null}if(i){if(g.isFunction(i)){return this.each(function(k){g(this).offset(i.call(this,k,g(this).offset()))})}return this.each(function(){g.offset.setOffset(this,i)})}return c.call(this)}}if(!g.curCSS){g.curCSS=g.css}(function(){var j=document.getElementsByTagName("body")[0],q=document.createElement("div"),n,p,k,o,m;n=document.createElement(j?"div":"body");k={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(j){g.extend(k,{position:"absolute",left:"-1000px",top:"-1000px"})}for(var l in k){n.style[l]=k[l]}n.appendChild(q);p=j||document.documentElement;p.insertBefore(n,p.firstChild);q.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;";o=g(q).offset(function(i,r){return r}).offset();n.innerHTML="";p.removeChild(n);m=o.top+o.left+(j?2000:0);f.fractions=m>21&&m<22})()}(jQuery));
/*!
 * jQuery UI Draggable 1.8.24
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Draggables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(a,b){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=="original"&&!(/^(?:r|a|f)/).test(this.element.css("position"))){this.element[0].style.position="relative"}(this.options.addClasses&&this.element.addClass("ui-draggable"));(this.options.disabled&&this.element.addClass("ui-draggable-disabled"));this._mouseInit()},destroy:function(){if(!this.element.data("draggable")){return}this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this},_mouseCapture:function(c){var d=this.options;if(this.helper||d.disabled||a(c.target).is(".ui-resizable-handle")){return false}this.handle=this._getHandle(c);if(!this.handle){return false}if(d.iframeFix){a(d.iframeFix===true?"iframe":d.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css(a(this).offset()).appendTo("body")})}return true},_mouseStart:function(c){var d=this.options;this.helper=this._createHelper(c);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if(a.ui.ddmanager){a.ui.ddmanager.current=this}this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:c.pageX-this.offset.left,top:c.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(c);this.originalPageX=c.pageX;this.originalPageY=c.pageY;(d.cursorAt&&this._adjustOffsetFromHelper(d.cursorAt));if(d.containment){this._setContainment()}if(this._trigger("start",c)===false){this._clear();return false}this._cacheHelperProportions();if(a.ui.ddmanager&&!d.dropBehaviour){a.ui.ddmanager.prepareOffsets(this,c)}this._mouseDrag(c,true);if(a.ui.ddmanager){a.ui.ddmanager.dragStart(this,c)}return true},_mouseDrag:function(c,e){this.position=this._generatePosition(c);this.positionAbs=this._convertPositionTo("absolute");if(!e){var d=this._uiHash();if(this._trigger("drag",c,d)===false){this._mouseUp({});return false}this.position=d.position}if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px"}if(a.ui.ddmanager){a.ui.ddmanager.drag(this,c)}return false},_mouseStop:function(e){var g=false;if(a.ui.ddmanager&&!this.options.dropBehaviour){g=a.ui.ddmanager.drop(this,e)}if(this.dropped){g=this.dropped;this.dropped=false}var d=this.element[0],f=false;while(d&&(d=d.parentNode)){if(d==document){f=true}}if(!f&&this.options.helper==="original"){return false}if((this.options.revert=="invalid"&&!g)||(this.options.revert=="valid"&&g)||this.options.revert===true||(a.isFunction(this.options.revert)&&this.options.revert.call(this.element,g))){var c=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(c._trigger("stop",e)!==false){c._clear()}})}else{if(this._trigger("stop",e)!==false){this._clear()}}return false},_mouseUp:function(c){a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});if(a.ui.ddmanager){a.ui.ddmanager.dragStop(this,c)}return a.ui.mouse.prototype._mouseUp.call(this,c)},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({})}else{this._clear()}return this},_getHandle:function(c){var d=!this.options.handle||!a(this.options.handle,this.element).length?true:false;a(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==c.target){d=true}});return d},_createHelper:function(d){var e=this.options;var c=a.isFunction(e.helper)?a(e.helper.apply(this.element[0],[d])):(e.helper=="clone"?this.element.clone().removeAttr("id"):this.element);if(!c.parents("body").length){c.appendTo((e.appendTo=="parent"?this.element[0].parentNode:e.appendTo))}if(c[0]!=this.element[0]&&!(/(fixed|absolute)/).test(c.css("position"))){c.css("position","absolute")}return c},_adjustOffsetFromHelper:function(c){if(typeof c=="string"){c=c.split(" ")}if(a.isArray(c)){c={left:+c[0],top:+c[1]||0}}if("left" in c){this.offset.click.left=c.left+this.margins.left}if("right" in c){this.offset.click.left=this.helperProportions.width-c.right+this.margins.left}if("top" in c){this.offset.click.top=c.top+this.margins.top}if("bottom" in c){this.offset.click.top=this.helperProportions.height-c.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var c=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])){c.left+=this.scrollParent.scrollLeft();c.top+=this.scrollParent.scrollTop()}if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)){c={top:0,left:0}}return{top:c.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:c.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var c=this.element.position();return{top:c.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:c.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var g=this.options;if(g.containment=="parent"){g.containment=this.helper[0].parentNode}if(g.containment=="document"||g.containment=="window"){this.containment=[g.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,g.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(g.containment=="document"?0:a(window).scrollLeft())+a(g.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(g.containment=="document"?0:a(window).scrollTop())+(a(g.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!(/^(document|window|parent)$/).test(g.containment)&&g.containment.constructor!=Array){var h=a(g.containment);var e=h[0];if(!e){return}var f=h.offset();var d=(a(e).css("overflow")!="hidden");this.containment=[(parseInt(a(e).css("borderLeftWidth"),10)||0)+(parseInt(a(e).css("paddingLeft"),10)||0),(parseInt(a(e).css("borderTopWidth"),10)||0)+(parseInt(a(e).css("paddingTop"),10)||0),(d?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(a(e).css("borderLeftWidth"),10)||0)-(parseInt(a(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(d?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(a(e).css("borderTopWidth"),10)||0)-(parseInt(a(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=h}else{if(g.containment.constructor==Array){this.containment=g.containment}}},_convertPositionTo:function(g,i){if(!i){i=this.position}var e=g=="absolute"?1:-1;var f=this.options,c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=(/(html|body)/i).test(c[0].tagName);return{top:(i.top+this.offset.relative.top*e+this.offset.parent.top*e-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(h?0:c.scrollTop()))*e)),left:(i.left+this.offset.relative.left*e+this.offset.parent.left*e-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:c.scrollLeft())*e))}},_generatePosition:function(d){var e=this.options,l=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=(/(html|body)/i).test(l[0].tagName);var h=d.pageX;var g=d.pageY;if(this.originalPosition){var c;if(this.containment){if(this.relative_container){var k=this.relative_container.offset();c=[this.containment[0]+k.left,this.containment[1]+k.top,this.containment[2]+k.left,this.containment[3]+k.top]}else{c=this.containment}if(d.pageX-this.offset.click.left<c[0]){h=c[0]+this.offset.click.left}if(d.pageY-this.offset.click.top<c[1]){g=c[1]+this.offset.click.top}if(d.pageX-this.offset.click.left>c[2]){h=c[2]+this.offset.click.left}if(d.pageY-this.offset.click.top>c[3]){g=c[3]+this.offset.click.top}}if(e.grid){var j=e.grid[1]?this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1]:this.originalPageY;g=c?(!(j-this.offset.click.top<c[1]||j-this.offset.click.top>c[3])?j:(!(j-this.offset.click.top<c[1])?j-e.grid[1]:j+e.grid[1])):j;var f=e.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/e.grid[0])*e.grid[0]:this.originalPageX;h=c?(!(f-this.offset.click.left<c[0]||f-this.offset.click.left>c[2])?f:(!(f-this.offset.click.left<c[0])?f-e.grid[0]:f+e.grid[0])):f}}return{top:(g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(i?0:l.scrollTop())))),left:(h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:l.scrollLeft())))}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval){this.helper.remove()}this.helper=null;this.cancelHelperRemoval=false},_trigger:function(c,d,e){e=e||this._uiHash();a.ui.plugin.call(this,c,[d,e]);if(c=="drag"){this.positionAbs=this._convertPositionTo("absolute")}return a.Widget.prototype._trigger.call(this,c,d,e)},plugins:{},_uiHash:function(c){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});a.extend(a.ui.draggable,{version:"1.8.24"});a.ui.plugin.add("draggable","connectToSortable",{start:function(d,f){var e=a(this).data("draggable"),g=e.options,c=a.extend({},f,{item:e.element});e.sortables=[];a(g.connectToSortable).each(function(){var h=a.data(this,"sortable");if(h&&!h.options.disabled){e.sortables.push({instance:h,shouldRevert:h.options.revert});h.refreshPositions();h._trigger("activate",d,c)}})},stop:function(d,f){var e=a(this).data("draggable"),c=a.extend({},f,{item:e.element});a.each(e.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;e.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert){this.instance.options.revert=true}this.instance._mouseStop(d);this.instance.options.helper=this.instance.options._helper;if(e.options.helper=="original"){this.instance.currentItem.css({top:"auto",left:"auto"})}}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",d,c)}})},drag:function(d,g){var f=a(this).data("draggable"),c=this;var e=function(j){var p=this.offset.click.top,n=this.offset.click.left;var h=this.positionAbs.top,l=this.positionAbs.left;var k=j.height,m=j.width;var q=j.top,i=j.left;return a.ui.isOver(h+p,l+n,q,i,k,m)};a.each(f.sortables,function(h){this.instance.positionAbs=f.positionAbs;this.instance.helperProportions=f.helperProportions;this.instance.offset.click=f.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=a(c).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return g.helper[0]};d.target=this.instance.currentItem[0];this.instance._mouseCapture(d,true);this.instance._mouseStart(d,true,true);this.instance.offset.click.top=f.offset.click.top;this.instance.offset.click.left=f.offset.click.left;this.instance.offset.parent.left-=f.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=f.offset.parent.top-this.instance.offset.parent.top;f._trigger("toSortable",d);f.dropped=this.instance.element;f.currentItem=f.element;this.instance.fromOutside=f}if(this.instance.currentItem){this.instance._mouseDrag(d)}}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",d,this.instance._uiHash(this.instance));this.instance._mouseStop(d,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder){this.instance.placeholder.remove()}f._trigger("fromSortable",d);f.dropped=false}}})}});a.ui.plugin.add("draggable","cursor",{start:function(d,e){var c=a("body"),f=a(this).data("draggable").options;if(c.css("cursor")){f._cursor=c.css("cursor")}c.css("cursor",f.cursor)},stop:function(c,d){var e=a(this).data("draggable").options;if(e._cursor){a("body").css("cursor",e._cursor)}}});a.ui.plugin.add("draggable","opacity",{start:function(d,e){var c=a(e.helper),f=a(this).data("draggable").options;if(c.css("opacity")){f._opacity=c.css("opacity")}c.css("opacity",f.opacity)},stop:function(c,d){var e=a(this).data("draggable").options;if(e._opacity){a(d.helper).css("opacity",e._opacity)}}});a.ui.plugin.add("draggable","scroll",{start:function(d,e){var c=a(this).data("draggable");if(c.scrollParent[0]!=document&&c.scrollParent[0].tagName!="HTML"){c.overflowOffset=c.scrollParent.offset()}},drag:function(e,f){var d=a(this).data("draggable"),g=d.options,c=false;if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"){if(!g.axis||g.axis!="x"){if((d.overflowOffset.top+d.scrollParent[0].offsetHeight)-e.pageY<g.scrollSensitivity){d.scrollParent[0].scrollTop=c=d.scrollParent[0].scrollTop+g.scrollSpeed}else{if(e.pageY-d.overflowOffset.top<g.scrollSensitivity){d.scrollParent[0].scrollTop=c=d.scrollParent[0].scrollTop-g.scrollSpeed}}}if(!g.axis||g.axis!="y"){if((d.overflowOffset.left+d.scrollParent[0].offsetWidth)-e.pageX<g.scrollSensitivity){d.scrollParent[0].scrollLeft=c=d.scrollParent[0].scrollLeft+g.scrollSpeed}else{if(e.pageX-d.overflowOffset.left<g.scrollSensitivity){d.scrollParent[0].scrollLeft=c=d.scrollParent[0].scrollLeft-g.scrollSpeed}}}}else{if(!g.axis||g.axis!="x"){if(e.pageY-a(document).scrollTop()<g.scrollSensitivity){c=a(document).scrollTop(a(document).scrollTop()-g.scrollSpeed)}else{if(a(window).height()-(e.pageY-a(document).scrollTop())<g.scrollSensitivity){c=a(document).scrollTop(a(document).scrollTop()+g.scrollSpeed)}}}if(!g.axis||g.axis!="y"){if(e.pageX-a(document).scrollLeft()<g.scrollSensitivity){c=a(document).scrollLeft(a(document).scrollLeft()-g.scrollSpeed)}else{if(a(window).width()-(e.pageX-a(document).scrollLeft())<g.scrollSensitivity){c=a(document).scrollLeft(a(document).scrollLeft()+g.scrollSpeed)}}}}if(c!==false&&a.ui.ddmanager&&!g.dropBehaviour){a.ui.ddmanager.prepareOffsets(d,e)}}});a.ui.plugin.add("draggable","snap",{start:function(d,e){var c=a(this).data("draggable"),f=c.options;c.snapElements=[];a(f.snap.constructor!=String?(f.snap.items||":data(draggable)"):f.snap).each(function(){var h=a(this);var g=h.offset();if(this!=c.element[0]){c.snapElements.push({item:this,width:h.outerWidth(),height:h.outerHeight(),top:g.top,left:g.left})}})},drag:function(u,p){var g=a(this).data("draggable"),q=g.options;var y=q.snapTolerance;var x=p.offset.left,w=x+g.helperProportions.width,f=p.offset.top,e=f+g.helperProportions.height;for(var v=g.snapElements.length-1;v>=0;v--){var s=g.snapElements[v].left,n=s+g.snapElements[v].width,m=g.snapElements[v].top,A=m+g.snapElements[v].height;if(!((s-y<x&&x<n+y&&m-y<f&&f<A+y)||(s-y<x&&x<n+y&&m-y<e&&e<A+y)||(s-y<w&&w<n+y&&m-y<f&&f<A+y)||(s-y<w&&w<n+y&&m-y<e&&e<A+y))){if(g.snapElements[v].snapping){(g.options.snap.release&&g.options.snap.release.call(g.element,u,a.extend(g._uiHash(),{snapItem:g.snapElements[v].item})))}g.snapElements[v].snapping=false;continue}if(q.snapMode!="inner"){var c=Math.abs(m-e)<=y;var z=Math.abs(A-f)<=y;var j=Math.abs(s-w)<=y;var k=Math.abs(n-x)<=y;if(c){p.position.top=g._convertPositionTo("relative",{top:m-g.helperProportions.height,left:0}).top-g.margins.top}if(z){p.position.top=g._convertPositionTo("relative",{top:A,left:0}).top-g.margins.top}if(j){p.position.left=g._convertPositionTo("relative",{top:0,left:s-g.helperProportions.width}).left-g.margins.left}if(k){p.position.left=g._convertPositionTo("relative",{top:0,left:n}).left-g.margins.left}}var h=(c||z||j||k);if(q.snapMode!="outer"){var c=Math.abs(m-f)<=y;var z=Math.abs(A-e)<=y;var j=Math.abs(s-x)<=y;var k=Math.abs(n-w)<=y;if(c){p.position.top=g._convertPositionTo("relative",{top:m,left:0}).top-g.margins.top}if(z){p.position.top=g._convertPositionTo("relative",{top:A-g.helperProportions.height,left:0}).top-g.margins.top}if(j){p.position.left=g._convertPositionTo("relative",{top:0,left:s}).left-g.margins.left}if(k){p.position.left=g._convertPositionTo("relative",{top:0,left:n-g.helperProportions.width}).left-g.margins.left}}if(!g.snapElements[v].snapping&&(c||z||j||k||h)){(g.options.snap.snap&&g.options.snap.snap.call(g.element,u,a.extend(g._uiHash(),{snapItem:g.snapElements[v].item})))}g.snapElements[v].snapping=(c||z||j||k||h)}}});a.ui.plugin.add("draggable","stack",{start:function(d,e){var g=a(this).data("draggable").options;var f=a.makeArray(a(g.stack)).sort(function(i,h){return(parseInt(a(i).css("zIndex"),10)||0)-(parseInt(a(h).css("zIndex"),10)||0)});if(!f.length){return}var c=parseInt(f[0].style.zIndex)||0;a(f).each(function(h){this.style.zIndex=c+h});this[0].style.zIndex=c+f.length}});a.ui.plugin.add("draggable","zIndex",{start:function(d,e){var c=a(e.helper),f=a(this).data("draggable").options;if(c.css("zIndex")){f._zIndex=c.css("zIndex")}c.css("zIndex",f.zIndex)},stop:function(c,d){var e=a(this).data("draggable").options;if(e._zIndex){a(d.helper).css("zIndex",e._zIndex)}}})})(jQuery);
/*!
 * jQuery UI Resizable 1.8.24
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Resizables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(c,d){c.widget("ui.resizable",c.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var f=this,k=this.options;this.element.addClass("ui-resizable");c.extend(this,{_aspectRatio:!!(k.aspectRatio),aspectRatio:k.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:k.helper||k.ghost||k.animate?k.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){this.element.wrap(c('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=k.handles||(!c(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all"){this.handles="n,e,s,w,se,sw,ne,nw"}var l=this.handles.split(",");this.handles={};for(var g=0;g<l.length;g++){var j=c.trim(l[g]),e="ui-resizable-"+j;var h=c('<div class="ui-resizable-handle '+e+'"></div>');h.css({zIndex:k.zIndex});if("se"==j){h.addClass("ui-icon ui-icon-gripsmall-diagonal-se")}this.handles[j]=".ui-resizable-"+j;this.element.append(h)}}this._renderAxis=function(q){q=q||this.element;for(var n in this.handles){if(this.handles[n].constructor==String){this.handles[n]=c(this.handles[n],this.element).show()}if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var o=c(this.handles[n],this.element),p=0;p=/sw|ne|nw|se|n|s/.test(n)?o.outerHeight():o.outerWidth();var m=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join("");q.css(m,p);this._proportionallyResize()}if(!c(this.handles[n]).length){continue}}};this._renderAxis(this.element);this._handles=c(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!f.resizing){if(this.className){var i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)}f.axis=i&&i[1]?i[1]:"se"}});if(k.autoHide){this._handles.hide();c(this.element).addClass("ui-resizable-autohide").hover(function(){if(k.disabled){return}c(this).removeClass("ui-resizable-autohide");f._handles.show()},function(){if(k.disabled){return}if(!f.resizing){c(this).addClass("ui-resizable-autohide");f._handles.hide()}})}this._mouseInit()},destroy:function(){this._mouseDestroy();var e=function(g){c(g).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){e(this.element);var f=this.element;f.after(this.originalElement.css({position:f.css("position"),width:f.outerWidth(),height:f.outerHeight(),top:f.css("top"),left:f.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);e(this.originalElement);return this},_mouseCapture:function(f){var g=false;for(var e in this.handles){if(c(this.handles[e])[0]==f.target){g=true}}return !this.options.disabled&&g},_mouseStart:function(g){var j=this.options,f=this.element.position(),e=this.element;this.resizing=true;this.documentScroll={top:c(document).scrollTop(),left:c(document).scrollLeft()};if(e.is(".ui-draggable")||(/absolute/).test(e.css("position"))){e.css({position:"absolute",top:f.top,left:f.left})}this._renderProxy();var k=b(this.helper.css("left")),h=b(this.helper.css("top"));if(j.containment){k+=c(j.containment).scrollLeft()||0;h+=c(j.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:k,top:h};this.size=this._helper?{width:e.outerWidth(),height:e.outerHeight()}:{width:e.width(),height:e.height()};this.originalSize=this._helper?{width:e.outerWidth(),height:e.outerHeight()}:{width:e.width(),height:e.height()};this.originalPosition={left:k,top:h};this.sizeDiff={width:e.outerWidth()-e.width(),height:e.outerHeight()-e.height()};this.originalMousePosition={left:g.pageX,top:g.pageY};this.aspectRatio=(typeof j.aspectRatio=="number")?j.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);var i=c(".ui-resizable-"+this.axis).css("cursor");c("body").css("cursor",i=="auto"?this.axis+"-resize":i);e.addClass("ui-resizable-resizing");this._propagate("start",g);return true},_mouseDrag:function(e){var h=this.helper,g=this.options,m={},q=this,j=this.originalMousePosition,n=this.axis;var r=(e.pageX-j.left)||0,p=(e.pageY-j.top)||0;var i=this._change[n];if(!i){return false}var l=i.apply(this,[e,r,p]),k=c.browser.msie&&c.browser.version<7,f=this.sizeDiff;this._updateVirtualBoundaries(e.shiftKey);if(this._aspectRatio||e.shiftKey){l=this._updateRatio(l,e)}l=this._respectSize(l,e);this._propagate("resize",e);h.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length){this._proportionallyResize()}this._updateCache(l);this._trigger("resize",e,this.ui());return false},_mouseStop:function(h){this.resizing=false;var i=this.options,m=this;if(this._helper){var g=this._proportionallyResizeElements,e=g.length&&(/textarea/i).test(g[0].nodeName),f=e&&c.ui.hasScroll(g[0],"left")?0:m.sizeDiff.height,k=e?0:m.sizeDiff.width;var n={width:(m.helper.width()-k),height:(m.helper.height()-f)},j=(parseInt(m.element.css("left"),10)+(m.position.left-m.originalPosition.left))||null,l=(parseInt(m.element.css("top"),10)+(m.position.top-m.originalPosition.top))||null;if(!i.animate){this.element.css(c.extend(n,{top:l,left:j}))}m.helper.height(m.size.height);m.helper.width(m.size.width);if(this._helper&&!i.animate){this._proportionallyResize()}}c("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",h);if(this._helper){this.helper.remove()}return false},_updateVirtualBoundaries:function(g){var j=this.options,i,h,f,k,e;e={minWidth:a(j.minWidth)?j.minWidth:0,maxWidth:a(j.maxWidth)?j.maxWidth:Infinity,minHeight:a(j.minHeight)?j.minHeight:0,maxHeight:a(j.maxHeight)?j.maxHeight:Infinity};if(this._aspectRatio||g){i=e.minHeight*this.aspectRatio;f=e.minWidth/this.aspectRatio;h=e.maxHeight*this.aspectRatio;k=e.maxWidth/this.aspectRatio;if(i>e.minWidth){e.minWidth=i}if(f>e.minHeight){e.minHeight=f}if(h<e.maxWidth){e.maxWidth=h}if(k<e.maxHeight){e.maxHeight=k}}this._vBoundaries=e},_updateCache:function(e){var f=this.options;this.offset=this.helper.offset();if(a(e.left)){this.position.left=e.left}if(a(e.top)){this.position.top=e.top}if(a(e.height)){this.size.height=e.height}if(a(e.width)){this.size.width=e.width}},_updateRatio:function(h,g){var i=this.options,j=this.position,f=this.size,e=this.axis;if(a(h.height)){h.width=(h.height*this.aspectRatio)}else{if(a(h.width)){h.height=(h.width/this.aspectRatio)}}if(e=="sw"){h.left=j.left+(f.width-h.width);h.top=null}if(e=="nw"){h.top=j.top+(f.height-h.height);h.left=j.left+(f.width-h.width)}return h},_respectSize:function(l,g){var j=this.helper,i=this._vBoundaries,r=this._aspectRatio||g.shiftKey,q=this.axis,t=a(l.width)&&i.maxWidth&&(i.maxWidth<l.width),m=a(l.height)&&i.maxHeight&&(i.maxHeight<l.height),h=a(l.width)&&i.minWidth&&(i.minWidth>l.width),s=a(l.height)&&i.minHeight&&(i.minHeight>l.height);if(h){l.width=i.minWidth}if(s){l.height=i.minHeight}if(t){l.width=i.maxWidth}if(m){l.height=i.maxHeight}var f=this.originalPosition.left+this.originalSize.width,p=this.position.top+this.size.height;var k=/sw|nw|w/.test(q),e=/nw|ne|n/.test(q);if(h&&k){l.left=f-i.minWidth}if(t&&k){l.left=f-i.maxWidth}if(s&&e){l.top=p-i.minHeight}if(m&&e){l.top=p-i.maxHeight}var n=!l.width&&!l.height;if(n&&!l.left&&l.top){l.top=null}else{if(n&&!l.top&&l.left){l.left=null}}return l},_proportionallyResize:function(){var k=this.options;if(!this._proportionallyResizeElements.length){return}var g=this.helper||this.element;for(var f=0;f<this._proportionallyResizeElements.length;f++){var h=this._proportionallyResizeElements[f];if(!this.borderDif){var e=[h.css("borderTopWidth"),h.css("borderRightWidth"),h.css("borderBottomWidth"),h.css("borderLeftWidth")],j=[h.css("paddingTop"),h.css("paddingRight"),h.css("paddingBottom"),h.css("paddingLeft")];this.borderDif=c.map(e,function(l,n){var m=parseInt(l,10)||0,o=parseInt(j[n],10)||0;return m+o})}if(c.browser.msie&&!(!(c(g).is(":hidden")||c(g).parents(":hidden").length))){continue}h.css({height:(g.height()-this.borderDif[0]-this.borderDif[2])||0,width:(g.width()-this.borderDif[1]-this.borderDif[3])||0})}},_renderProxy:function(){var f=this.element,i=this.options;this.elementOffset=f.offset();if(this._helper){this.helper=this.helper||c('<div style="overflow:hidden;"></div>');var e=c.browser.msie&&c.browser.version<7,g=(e?1:0),h=(e?2:-1);this.helper.addClass(this._helper).css({width:this.element.outerWidth()+h,height:this.element.outerHeight()+h,position:"absolute",left:this.elementOffset.left-g+"px",top:this.elementOffset.top-g+"px",zIndex:++i.zIndex});this.helper.appendTo("body").disableSelection()}else{this.helper=this.element}},_change:{e:function(g,f,e){return{width:this.originalSize.width+f}},w:function(h,f,e){var j=this.options,g=this.originalSize,i=this.originalPosition;return{left:i.left+f,width:g.width-f}},n:function(h,f,e){var j=this.options,g=this.originalSize,i=this.originalPosition;return{top:i.top+e,height:g.height-e}},s:function(g,f,e){return{height:this.originalSize.height+e}},se:function(g,f,e){return c.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[g,f,e]))},sw:function(g,f,e){return c.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[g,f,e]))},ne:function(g,f,e){return c.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[g,f,e]))},nw:function(g,f,e){return c.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[g,f,e]))}},_propagate:function(f,e){c.ui.plugin.call(this,f,[e,this.ui()]);(f!="resize"&&this._trigger(f,e,this.ui()))},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});c.extend(c.ui.resizable,{version:"1.8.24"});c.ui.plugin.add("resizable","alsoResize",{start:function(f,g){var e=c(this).data("resizable"),i=e.options;var h=function(j){c(j).each(function(){var k=c(this);k.data("resizable-alsoresize",{width:parseInt(k.width(),10),height:parseInt(k.height(),10),left:parseInt(k.css("left"),10),top:parseInt(k.css("top"),10)})})};if(typeof(i.alsoResize)=="object"&&!i.alsoResize.parentNode){if(i.alsoResize.length){i.alsoResize=i.alsoResize[0];h(i.alsoResize)}else{c.each(i.alsoResize,function(j){h(j)})}}else{h(i.alsoResize)}},resize:function(g,i){var f=c(this).data("resizable"),j=f.options,h=f.originalSize,l=f.originalPosition;var k={height:(f.size.height-h.height)||0,width:(f.size.width-h.width)||0,top:(f.position.top-l.top)||0,left:(f.position.left-l.left)||0},e=function(m,n){c(m).each(function(){var q=c(this),r=c(this).data("resizable-alsoresize"),p={},o=n&&n.length?n:q.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];c.each(o,function(s,u){var t=(r[u]||0)+(k[u]||0);if(t&&t>=0){p[u]=t||null}});q.css(p)})};if(typeof(j.alsoResize)=="object"&&!j.alsoResize.nodeType){c.each(j.alsoResize,function(m,n){e(m,n)})}else{e(j.alsoResize)}},stop:function(e,f){c(this).removeData("resizable-alsoresize")}});c.ui.plugin.add("resizable","animate",{stop:function(i,n){var p=c(this).data("resizable"),j=p.options;var h=p._proportionallyResizeElements,e=h.length&&(/textarea/i).test(h[0].nodeName),f=e&&c.ui.hasScroll(h[0],"left")?0:p.sizeDiff.height,l=e?0:p.sizeDiff.width;var g={width:(p.size.width-l),height:(p.size.height-f)},k=(parseInt(p.element.css("left"),10)+(p.position.left-p.originalPosition.left))||null,m=(parseInt(p.element.css("top"),10)+(p.position.top-p.originalPosition.top))||null;p.element.animate(c.extend(g,m&&k?{top:m,left:k}:{}),{duration:j.animateDuration,easing:j.animateEasing,step:function(){var o={width:parseInt(p.element.css("width"),10),height:parseInt(p.element.css("height"),10),top:parseInt(p.element.css("top"),10),left:parseInt(p.element.css("left"),10)};if(h&&h.length){c(h[0]).css({width:o.width,height:o.height})}p._updateCache(o);p._propagate("resize",i)}})}});c.ui.plugin.add("resizable","containment",{start:function(f,r){var t=c(this).data("resizable"),j=t.options,l=t.element;var g=j.containment,k=(g instanceof c)?g.get(0):(/parent/.test(g))?l.parent().get(0):g;if(!k){return}t.containerElement=c(k);if(/document/.test(g)||g==document){t.containerOffset={left:0,top:0};t.containerPosition={left:0,top:0};t.parentData={element:c(document),left:0,top:0,width:c(document).width(),height:c(document).height()||document.body.parentNode.scrollHeight}}else{var n=c(k),i=[];c(["Top","Right","Left","Bottom"]).each(function(p,o){i[p]=b(n.css("padding"+o))});t.containerOffset=n.offset();t.containerPosition=n.position();t.containerSize={height:(n.innerHeight()-i[3]),width:(n.innerWidth()-i[1])};var q=t.containerOffset,e=t.containerSize.height,m=t.containerSize.width,h=(c.ui.hasScroll(k,"left")?k.scrollWidth:m),s=(c.ui.hasScroll(k)?k.scrollHeight:e);t.parentData={element:k,left:q.left,top:q.top,width:h,height:s}}},resize:function(g,q){var t=c(this).data("resizable"),i=t.options,f=t.containerSize,p=t.containerOffset,m=t.size,n=t.position,r=t._aspectRatio||g.shiftKey,e={top:0,left:0},h=t.containerElement;if(h[0]!=document&&(/static/).test(h.css("position"))){e=p}if(n.left<(t._helper?p.left:0)){t.size.width=t.size.width+(t._helper?(t.position.left-p.left):(t.position.left-e.left));if(r){t.size.height=t.size.width/t.aspectRatio}t.position.left=i.helper?p.left:0}if(n.top<(t._helper?p.top:0)){t.size.height=t.size.height+(t._helper?(t.position.top-p.top):t.position.top);if(r){t.size.width=t.size.height*t.aspectRatio}t.position.top=t._helper?p.top:0}t.offset.left=t.parentData.left+t.position.left;t.offset.top=t.parentData.top+t.position.top;var l=Math.abs((t._helper?t.offset.left-e.left:(t.offset.left-e.left))+t.sizeDiff.width),s=Math.abs((t._helper?t.offset.top-e.top:(t.offset.top-p.top))+t.sizeDiff.height);var k=t.containerElement.get(0)==t.element.parent().get(0),j=/relative|absolute/.test(t.containerElement.css("position"));if(k&&j){l-=t.parentData.left}if(l+t.size.width>=t.parentData.width){t.size.width=t.parentData.width-l;if(r){t.size.height=t.size.width/t.aspectRatio}}if(s+t.size.height>=t.parentData.height){t.size.height=t.parentData.height-s;if(r){t.size.width=t.size.height*t.aspectRatio}}},stop:function(f,n){var q=c(this).data("resizable"),g=q.options,l=q.position,m=q.containerOffset,e=q.containerPosition,i=q.containerElement;var j=c(q.helper),r=j.offset(),p=j.outerWidth()-q.sizeDiff.width,k=j.outerHeight()-q.sizeDiff.height;if(q._helper&&!g.animate&&(/relative/).test(i.css("position"))){c(this).css({left:r.left-e.left-m.left,width:p,height:k})}if(q._helper&&!g.animate&&(/static/).test(i.css("position"))){c(this).css({left:r.left-e.left-m.left,width:p,height:k})}}});c.ui.plugin.add("resizable","ghost",{start:function(g,h){var e=c(this).data("resizable"),i=e.options,f=e.size;e.ghost=e.originalElement.clone();e.ghost.css({opacity:0.25,display:"block",position:"relative",height:f.height,width:f.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof i.ghost=="string"?i.ghost:"");e.ghost.appendTo(e.helper)},resize:function(f,g){var e=c(this).data("resizable"),h=e.options;if(e.ghost){e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})}},stop:function(f,g){var e=c(this).data("resizable"),h=e.options;if(e.ghost&&e.helper){e.helper.get(0).removeChild(e.ghost.get(0))}}});c.ui.plugin.add("resizable","grid",{resize:function(e,m){var p=c(this).data("resizable"),h=p.options,k=p.size,i=p.originalSize,j=p.originalPosition,n=p.axis,l=h._aspectRatio||e.shiftKey;h.grid=typeof h.grid=="number"?[h.grid,h.grid]:h.grid;var g=Math.round((k.width-i.width)/(h.grid[0]||1))*(h.grid[0]||1),f=Math.round((k.height-i.height)/(h.grid[1]||1))*(h.grid[1]||1);if(/^(se|s|e)$/.test(n)){p.size.width=i.width+g;p.size.height=i.height+f}else{if(/^(ne)$/.test(n)){p.size.width=i.width+g;p.size.height=i.height+f;p.position.top=j.top-f}else{if(/^(sw)$/.test(n)){p.size.width=i.width+g;p.size.height=i.height+f;p.position.left=j.left-g}else{p.size.width=i.width+g;p.size.height=i.height+f;p.position.top=j.top-f;p.position.left=j.left-g}}}}});var b=function(e){return parseInt(e,10)||0};var a=function(e){return !isNaN(parseInt(e,10))}})(jQuery);
/*!
 * jQuery UI Sortable 1.8.24
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Sortables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(a,b){a.widget("ui.sortable",a.ui.mouse,{widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var c=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?c.axis==="x"||(/left|right/).test(this.items[0].item.css("float"))||(/inline|table-cell/).test(this.items[0].item.css("display")):false;this.offset=this.element.offset();this._mouseInit();this.ready=true},destroy:function(){a.Widget.prototype.destroy.call(this);this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var c=this.items.length-1;c>=0;c--){this.items[c].item.removeData(this.widgetName+"-item")}return this},_setOption:function(c,d){if(c==="disabled"){this.options[c]=d;this.widget()[d?"addClass":"removeClass"]("ui-sortable-disabled")}else{a.Widget.prototype._setOption.apply(this,arguments)}},_mouseCapture:function(g,h){var f=this;if(this.reverting){return false}if(this.options.disabled||this.options.type=="static"){return false}this._refreshItems(g);var e=null,d=this,c=a(g.target).parents().each(function(){if(a.data(this,f.widgetName+"-item")==d){e=a(this);return false}});if(a.data(g.target,f.widgetName+"-item")==d){e=a(g.target)}if(!e){return false}if(this.options.handle&&!h){var i=false;a(this.options.handle,e).find("*").andSelf().each(function(){if(this==g.target){i=true}});if(!i){return false}}this.currentItem=e;this._removeCurrentsFromItems();return true},_mouseStart:function(f,g,c){var h=this.options,d=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(f);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:f.pageX-this.offset.left,top:f.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(f);this.originalPageX=f.pageX;this.originalPageY=f.pageY;(h.cursorAt&&this._adjustOffsetFromHelper(h.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!=this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();if(h.containment){this._setContainment()}if(h.cursor){if(a("body").css("cursor")){this._storedCursor=a("body").css("cursor")}a("body").css("cursor",h.cursor)}if(h.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity")}this.helper.css("opacity",h.opacity)}if(h.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex")}this.helper.css("zIndex",h.zIndex)}if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"){this.overflowOffset=this.scrollParent.offset()}this._trigger("start",f,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions()}if(!c){for(var e=this.containers.length-1;e>=0;e--){this.containers[e]._trigger("activate",f,d._uiHash(this))}}if(a.ui.ddmanager){a.ui.ddmanager.current=this}if(a.ui.ddmanager&&!h.dropBehaviour){a.ui.ddmanager.prepareOffsets(this,f)}this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(f);return true},_mouseDrag:function(g){this.position=this._generatePosition(g);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs}if(this.options.scroll){var h=this.options,c=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-g.pageY<h.scrollSensitivity){this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop+h.scrollSpeed}else{if(g.pageY-this.overflowOffset.top<h.scrollSensitivity){this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop-h.scrollSpeed}}if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-g.pageX<h.scrollSensitivity){this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft+h.scrollSpeed}else{if(g.pageX-this.overflowOffset.left<h.scrollSensitivity){this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft-h.scrollSpeed}}}else{if(g.pageY-a(document).scrollTop()<h.scrollSensitivity){c=a(document).scrollTop(a(document).scrollTop()-h.scrollSpeed)}else{if(a(window).height()-(g.pageY-a(document).scrollTop())<h.scrollSensitivity){c=a(document).scrollTop(a(document).scrollTop()+h.scrollSpeed)}}if(g.pageX-a(document).scrollLeft()<h.scrollSensitivity){c=a(document).scrollLeft(a(document).scrollLeft()-h.scrollSpeed)}else{if(a(window).width()-(g.pageX-a(document).scrollLeft())<h.scrollSensitivity){c=a(document).scrollLeft(a(document).scrollLeft()+h.scrollSpeed)}}}if(c!==false&&a.ui.ddmanager&&!h.dropBehaviour){a.ui.ddmanager.prepareOffsets(this,g)}}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px"}for(var e=this.items.length-1;e>=0;e--){var f=this.items[e],d=f.item[0],j=this._intersectsWithPointer(f);if(!j){continue}if(f.instance!==this.currentContainer){continue}if(d!=this.currentItem[0]&&this.placeholder[j==1?"next":"prev"]()[0]!=d&&!a.ui.contains(this.placeholder[0],d)&&(this.options.type=="semi-dynamic"?!a.ui.contains(this.element[0],d):true)){this.direction=j==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(f)){this._rearrange(g,f)}else{break}this._trigger("change",g,this._uiHash());break}}this._contactContainers(g);if(a.ui.ddmanager){a.ui.ddmanager.drag(this,g)}this._trigger("sort",g,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(d,e){if(!d){return}if(a.ui.ddmanager&&!this.options.dropBehaviour){a.ui.ddmanager.drop(this,d)}if(this.options.revert){var c=this;var f=c.placeholder.offset();c.reverting=true;a(this.helper).animate({left:f.left-this.offset.parent.left-c.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:f.top-this.offset.parent.top-c.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){c._clear(d)})}else{this._clear(d,e)}return false},cancel:function(){var c=this;if(this.dragging){this._mouseUp({target:null});if(this.options.helper=="original"){this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}for(var d=this.containers.length-1;d>=0;d--){this.containers[d]._trigger("deactivate",null,c._uiHash(this));if(this.containers[d].containerCache.over){this.containers[d]._trigger("out",null,c._uiHash(this));this.containers[d].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0])}if(this.options.helper!="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove()}a.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){a(this.domPosition.prev).after(this.currentItem)}else{a(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function(e){var c=this._getItemsAsjQuery(e&&e.connected);var d=[];e=e||{};a(c).each(function(){var f=(a(e.item||this).attr(e.attribute||"id")||"").match(e.expression||(/(.+)[-=_](.+)/));if(f){d.push((e.key||f[1]+"[]")+"="+(e.key&&e.expression?f[1]:f[2]))}});if(!d.length&&e.key){d.push(e.key+"=")}return d.join("&")},toArray:function(e){var c=this._getItemsAsjQuery(e&&e.connected);var d=[];e=e||{};c.each(function(){d.push(a(e.item||this).attr(e.attribute||"id")||"")});return d},_intersectsWith:function(m){var e=this.positionAbs.left,d=e+this.helperProportions.width,k=this.positionAbs.top,j=k+this.helperProportions.height;var f=m.left,c=f+m.width,n=m.top,i=n+m.height;var o=this.offset.click.top,h=this.offset.click.left;var g=(k+o)>n&&(k+o)<i&&(e+h)>f&&(e+h)<c;if(this.options.tolerance=="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>m[this.floating?"width":"height"])){return g}else{return(f<e+(this.helperProportions.width/2)&&d-(this.helperProportions.width/2)<c&&n<k+(this.helperProportions.height/2)&&j-(this.helperProportions.height/2)<i)}},_intersectsWithPointer:function(e){var f=(this.options.axis==="x")||a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),d=(this.options.axis==="y")||a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),h=f&&d,c=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();if(!h){return false}return this.floating?(((g&&g=="right")||c=="down")?2:1):(c&&(c=="down"?2:1))},_intersectsWithSides:function(f){var d=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,f.top+(f.height/2),f.height),e=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,f.left+(f.width/2),f.width),c=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();if(this.floating&&g){return((g=="right"&&e)||(g=="left"&&!e))}else{return c&&((c=="down"&&d)||(c=="up"&&!d))}},_getDragVerticalDirection:function(){var c=this.positionAbs.top-this.lastPositionAbs.top;return c!=0&&(c>0?"down":"up")},_getDragHorizontalDirection:function(){var c=this.positionAbs.left-this.lastPositionAbs.left;return c!=0&&(c>0?"right":"left")},refresh:function(c){this._refreshItems(c);this.refreshPositions();return this},_connectWith:function(){var c=this.options;return c.connectWith.constructor==String?[c.connectWith]:c.connectWith},_getItemsAsjQuery:function(c){var m=this;var h=[];var f=[];var k=this._connectWith();if(k&&c){for(var e=k.length-1;e>=0;e--){var l=a(k[e]);for(var d=l.length-1;d>=0;d--){var g=a.data(l[d],this.widgetName);if(g&&g!=this&&!g.options.disabled){f.push([a.isFunction(g.options.items)?g.options.items.call(g.element):a(g.options.items,g.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),g])}}}}f.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var e=f.length-1;e>=0;e--){f[e][0].each(function(){h.push(this)})}return a(h)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");for(var d=0;d<this.items.length;d++){for(var c=0;c<e.length;c++){if(e[c]==this.items[d].item[0]){this.items.splice(d,1)}}}},_refreshItems:function(c){this.items=[];this.containers=[this];var k=this.items;var q=this;var g=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],c,{item:this.currentItem}):a(this.options.items,this.element),this]];var m=this._connectWith();if(m&&this.ready){for(var f=m.length-1;f>=0;f--){var n=a(m[f]);for(var e=n.length-1;e>=0;e--){var h=a.data(n[e],this.widgetName);if(h&&h!=this&&!h.options.disabled){g.push([a.isFunction(h.options.items)?h.options.items.call(h.element[0],c,{item:this.currentItem}):a(h.options.items,h.element),h]);this.containers.push(h)}}}}for(var f=g.length-1;f>=0;f--){var l=g[f][1];var d=g[f][0];for(var e=0,o=d.length;e<o;e++){var p=a(d[e]);p.data(this.widgetName+"-item",l);k.push({item:p,instance:l,width:0,height:0,left:0,top:0})}}},refreshPositions:function(c){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}for(var e=this.items.length-1;e>=0;e--){var f=this.items[e];if(f.instance!=this.currentContainer&&this.currentContainer&&f.item[0]!=this.currentItem[0]){continue}var d=this.options.toleranceElement?a(this.options.toleranceElement,f.item):f.item;if(!c){f.width=d.outerWidth();f.height=d.outerHeight()}var g=d.offset();f.left=g.left;f.top=g.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(var e=this.containers.length-1;e>=0;e--){var g=this.containers[e].element.offset();this.containers[e].containerCache.left=g.left;this.containers[e].containerCache.top=g.top;this.containers[e].containerCache.width=this.containers[e].element.outerWidth();this.containers[e].containerCache.height=this.containers[e].element.outerHeight()}}return this},_createPlaceholder:function(e){var c=e||this,f=c.options;if(!f.placeholder||f.placeholder.constructor==String){var d=f.placeholder;f.placeholder={element:function(){var g=a(document.createElement(c.currentItem[0].nodeName)).addClass(d||c.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!d){g.style.visibility="hidden"}return g},update:function(g,h){if(d&&!f.forcePlaceholderSize){return}if(!h.height()){h.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10))}if(!h.width()){h.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||0,10))}}}}c.placeholder=a(f.placeholder.element.call(c.element,c.currentItem));c.currentItem.after(c.placeholder);f.placeholder.update(c,c.placeholder)},_contactContainers:function(c){var e=null,l=null;for(var g=this.containers.length-1;g>=0;g--){if(a.ui.contains(this.currentItem[0],this.containers[g].element[0])){continue}if(this._intersectsWith(this.containers[g].containerCache)){if(e&&a.ui.contains(this.containers[g].element[0],e.element[0])){continue}e=this.containers[g];l=g}else{if(this.containers[g].containerCache.over){this.containers[g]._trigger("out",c,this._uiHash(this));this.containers[g].containerCache.over=0}}}if(!e){return}if(this.containers.length===1){this.containers[l]._trigger("over",c,this._uiHash(this));this.containers[l].containerCache.over=1}else{if(this.currentContainer!=this.containers[l]){var k=10000;var h=null;var d=this.positionAbs[this.containers[l].floating?"left":"top"];for(var f=this.items.length-1;f>=0;f--){if(!a.ui.contains(this.containers[l].element[0],this.items[f].item[0])){continue}var m=this.containers[l].floating?this.items[f].item.offset().left:this.items[f].item.offset().top;if(Math.abs(m-d)<k){k=Math.abs(m-d);h=this.items[f];this.direction=(m-d>0)?"down":"up"}}if(!h&&!this.options.dropOnEmpty){return}this.currentContainer=this.containers[l];h?this._rearrange(c,h,null,true):this._rearrange(c,null,this.containers[l].element,true);this._trigger("change",c,this._uiHash());this.containers[l]._trigger("change",c,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[l]._trigger("over",c,this._uiHash(this));this.containers[l].containerCache.over=1}}},_createHelper:function(d){var e=this.options;var c=a.isFunction(e.helper)?a(e.helper.apply(this.element[0],[d,this.currentItem])):(e.helper=="clone"?this.currentItem.clone():this.currentItem);if(!c.parents("body").length){a(e.appendTo!="parent"?e.appendTo:this.currentItem[0].parentNode)[0].appendChild(c[0])}if(c[0]==this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}}if(c[0].style.width==""||e.forceHelperSize){c.width(this.currentItem.width())}if(c[0].style.height==""||e.forceHelperSize){c.height(this.currentItem.height())}return c},_adjustOffsetFromHelper:function(c){if(typeof c=="string"){c=c.split(" ")}if(a.isArray(c)){c={left:+c[0],top:+c[1]||0}}if("left" in c){this.offset.click.left=c.left+this.margins.left}if("right" in c){this.offset.click.left=this.helperProportions.width-c.right+this.margins.left}if("top" in c){this.offset.click.top=c.top+this.margins.top}if("bottom" in c){this.offset.click.top=this.helperProportions.height-c.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var c=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])){c.left+=this.scrollParent.scrollLeft();c.top+=this.scrollParent.scrollTop()}if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)){c={top:0,left:0}}return{top:c.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:c.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var c=this.currentItem.position();return{top:c.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:c.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var f=this.options;if(f.containment=="parent"){f.containment=this.helper[0].parentNode}if(f.containment=="document"||f.containment=="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(f.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(f.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!(/^(document|window|parent)$/).test(f.containment)){var d=a(f.containment)[0];var e=a(f.containment).offset();var c=(a(d).css("overflow")!="hidden");this.containment=[e.left+(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0)-this.margins.left,e.top+(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0)-this.margins.top,e.left+(c?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderLeftWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,e.top+(c?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderTopWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(g,i){if(!i){i=this.position}var e=g=="absolute"?1:-1;var f=this.options,c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=(/(html|body)/i).test(c[0].tagName);return{top:(i.top+this.offset.relative.top*e+this.offset.parent.top*e-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(h?0:c.scrollTop()))*e)),left:(i.left+this.offset.relative.left*e+this.offset.parent.left*e-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:c.scrollLeft())*e))}},_generatePosition:function(f){var i=this.options,c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,j=(/(html|body)/i).test(c[0].tagName);if(this.cssPosition=="relative"&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}var e=f.pageX;var d=f.pageY;if(this.originalPosition){if(this.containment){if(f.pageX-this.offset.click.left<this.containment[0]){e=this.containment[0]+this.offset.click.left}if(f.pageY-this.offset.click.top<this.containment[1]){d=this.containment[1]+this.offset.click.top}if(f.pageX-this.offset.click.left>this.containment[2]){e=this.containment[2]+this.offset.click.left}if(f.pageY-this.offset.click.top>this.containment[3]){d=this.containment[3]+this.offset.click.top}}if(i.grid){var h=this.originalPageY+Math.round((d-this.originalPageY)/i.grid[1])*i.grid[1];d=this.containment?(!(h-this.offset.click.top<this.containment[1]||h-this.offset.click.top>this.containment[3])?h:(!(h-this.offset.click.top<this.containment[1])?h-i.grid[1]:h+i.grid[1])):h;var g=this.originalPageX+Math.round((e-this.originalPageX)/i.grid[0])*i.grid[0];e=this.containment?(!(g-this.offset.click.left<this.containment[0]||g-this.offset.click.left>this.containment[2])?g:(!(g-this.offset.click.left<this.containment[0])?g-i.grid[0]:g+i.grid[0])):g}}return{top:(d-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(j?0:c.scrollTop())))),left:(e-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():j?0:c.scrollLeft())))}},_rearrange:function(h,g,d,f){d?d[0].appendChild(this.placeholder[0]):g.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction=="down"?g.item[0]:g.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var e=this,c=this.counter;window.setTimeout(function(){if(c==e.counter){e.refreshPositions(!f)}},0)},_clear:function(e,f){this.reverting=false;var g=[],c=this;if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem)}this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var d in this._storedCSS){if(this._storedCSS[d]=="auto"||this._storedCSS[d]=="static"){this._storedCSS[d]=""}}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!f){g.push(function(h){this._trigger("receive",h,this._uiHash(this.fromOutside))})}if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!f){g.push(function(h){this._trigger("update",h,this._uiHash())})}if(this!==this.currentContainer){if(!f){g.push(function(h){this._trigger("remove",h,this._uiHash())});g.push((function(h){return function(i){h._trigger("receive",i,this._uiHash(this))}}).call(this,this.currentContainer));g.push((function(h){return function(i){h._trigger("update",i,this._uiHash(this))}}).call(this,this.currentContainer))}}for(var d=this.containers.length-1;d>=0;d--){if(!f){g.push((function(h){return function(i){h._trigger("deactivate",i,this._uiHash(this))}}).call(this,this.containers[d]))}if(this.containers[d].containerCache.over){g.push((function(h){return function(i){h._trigger("out",i,this._uiHash(this))}}).call(this,this.containers[d]));this.containers[d].containerCache.over=0}}if(this._storedCursor){a("body").css("cursor",this._storedCursor)}if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity)}if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex)}this.dragging=false;if(this.cancelHelperRemoval){if(!f){this._trigger("beforeStop",e,this._uiHash());for(var d=0;d<g.length;d++){g[d].call(this,e)}this._trigger("stop",e,this._uiHash())}this.fromOutside=false;return false}if(!f){this._trigger("beforeStop",e,this._uiHash())}this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!=this.currentItem[0]){this.helper.remove()}this.helper=null;if(!f){for(var d=0;d<g.length;d++){g[d].call(this,e)}this._trigger("stop",e,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){if(a.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel()}},_uiHash:function(d){var c=d||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:d?d.element:null}}});a.extend(a.ui.sortable,{version:"1.8.24"})})(jQuery);
/*!
 * jQuery UI Autocomplete 1.8.24
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Autocomplete
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 */
(function(a,b){var c=0;a.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var d=this,f=this.element[0].ownerDocument,e;this.isMultiLine=this.element.is("textarea");this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(g){if(d.options.disabled||d.element.propAttr("readOnly")){return}e=false;var h=a.ui.keyCode;switch(g.keyCode){case h.PAGE_UP:d._move("previousPage",g);break;case h.PAGE_DOWN:d._move("nextPage",g);break;case h.UP:d._keyEvent("previous",g);break;case h.DOWN:d._keyEvent("next",g);break;case h.ENTER:case h.NUMPAD_ENTER:if(d.menu.active){e=true;g.preventDefault()}case h.TAB:if(!d.menu.active){return}d.menu.select(g);break;case h.ESCAPE:d.element.val(d.term);d.close(g);break;default:clearTimeout(d.searching);d.searching=setTimeout(function(){if(d.term!=d.element.val()){d.selectedItem=null;d.search(null,g)}},d.options.delay);break}}).bind("keypress.autocomplete",function(g){if(e){e=false;g.preventDefault()}}).bind("focus.autocomplete",function(){if(d.options.disabled){return}d.selectedItem=null;d.previous=d.element.val()}).bind("blur.autocomplete",function(g){if(d.options.disabled){return}clearTimeout(d.searching);d.closing=setTimeout(function(){d.close(g);d._change(g)},150)});this._initSource();this.menu=a("<ul></ul>").addClass("ui-autocomplete").appendTo(a(this.options.appendTo||"body",f)[0]).mousedown(function(g){var h=d.menu.element[0];if(!a(g.target).closest(".ui-menu-item").length){setTimeout(function(){a(document).one("mousedown",function(i){if(i.target!==d.element[0]&&i.target!==h&&!a.ui.contains(h,i.target)){d.close()}})},1)}setTimeout(function(){clearTimeout(d.closing)},13)}).menu({focus:function(h,i){var g=i.item.data("item.autocomplete");if(false!==d._trigger("focus",h,{item:g})){if(/^key/.test(h.originalEvent.type)){d.element.val(g.value)}}},selected:function(i,j){var h=j.item.data("item.autocomplete"),g=d.previous;if(d.element[0]!==f.activeElement){d.element.focus();d.previous=g;setTimeout(function(){d.previous=g;d.selectedItem=h},1)}if(false!==d._trigger("select",i,{item:h})){d.element.val(h.value)}d.term=d.element.val();d.close(i);d.selectedItem=h},blur:function(g,h){if(d.menu.element.is(":visible")&&(d.element.val()!==d.term)){d.element.val(d.term)}}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");if(a.fn.bgiframe){this.menu.element.bgiframe()}d.beforeunloadHandler=function(){d.element.removeAttr("autocomplete")};a(window).bind("beforeunload",d.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();a(window).unbind("beforeunload",this.beforeunloadHandler);a.Widget.prototype.destroy.call(this)},_setOption:function(d,e){a.Widget.prototype._setOption.apply(this,arguments);if(d==="source"){this._initSource()}if(d==="appendTo"){this.menu.element.appendTo(a(e||"body",this.element[0].ownerDocument)[0])}if(d==="disabled"&&e&&this.xhr){this.xhr.abort()}},_initSource:function(){var d=this,f,e;if(a.isArray(this.options.source)){f=this.options.source;this.source=function(h,g){g(a.ui.autocomplete.filter(f,h.term))}}else{if(typeof this.options.source==="string"){e=this.options.source;this.source=function(h,g){if(d.xhr){d.xhr.abort()}d.xhr=a.ajax({url:e,data:h,dataType:"json",success:function(j,i){g(j)},error:function(){g([])}})}}else{this.source=this.options.source}}},search:function(e,d){e=e!=null?e:this.element.val();this.term=this.element.val();if(e.length<this.options.minLength){return this.close(d)}clearTimeout(this.closing);if(this._trigger("search",d)===false){return}return this._search(e)},_search:function(d){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:d},this._response())},_response:function(){var e=this,d=++c;return function(f){if(d===c){e.__response(f)}e.pending--;if(!e.pending){e.element.removeClass("ui-autocomplete-loading")}}},__response:function(d){if(!this.options.disabled&&d&&d.length){d=this._normalize(d);this._suggest(d);this._trigger("open")}else{this.close()}},close:function(d){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.deactivate();this._trigger("close",d)}},_change:function(d){if(this.previous!==this.element.val()){this._trigger("change",d,{item:this.selectedItem})}},_normalize:function(d){if(d.length&&d[0].label&&d[0].value){return d}return a.map(d,function(e){if(typeof e==="string"){return{label:e,value:e}}return a.extend({label:e.label||e.value,value:e.value||e.label},e)})},_suggest:function(d){var e=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(e,d);this.menu.deactivate();this.menu.refresh();e.show();this._resizeMenu();e.position(a.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next(new a.Event("mouseover"))}},_resizeMenu:function(){var d=this.menu.element;d.outerWidth(Math.max(d.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(f,e){var d=this;a.each(e,function(g,h){d._renderItem(f,h)})},_renderItem:function(d,e){return a("<li></li>").data("item.autocomplete",e).append(a("<a></a>").text(e.label)).appendTo(d)},_move:function(e,d){if(!this.menu.element.is(":visible")){this.search(null,d);return}if(this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e)){this.element.val(this.term);this.menu.deactivate();return}this.menu[e](d)},widget:function(){return this.menu.element},_keyEvent:function(e,d){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(e,d);d.preventDefault()}}});a.extend(a.ui.autocomplete,{escapeRegex:function(d){return d.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(f,d){var e=new RegExp(a.ui.autocomplete.escapeRegex(d),"i");return a.grep(f,function(g){return e.test(g.label||g.value||g)})}})}(jQuery));(function(a){a.widget("ui.menu",{_create:function(){var b=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(c){if(!a(c.target).closest(".ui-menu-item a").length){return}c.preventDefault();b.select(c)});this.refresh()},refresh:function(){var c=this;var b=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");b.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(d){c.activate(d,a(this).parent())}).mouseleave(function(){c.deactivate()})},activate:function(e,d){this.deactivate();if(this.hasScroll()){var f=d.offset().top-this.element.offset().top,b=this.element.scrollTop(),c=this.element.height();if(f<0){this.element.scrollTop(b+f)}else{if(f>=c){this.element.scrollTop(b+f-c+d.height())}}}this.active=d.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",e,{item:d})},deactivate:function(){if(!this.active){return}this.active.children("a").removeClass("ui-state-hover").removeAttr("id");this._trigger("blur");this.active=null},next:function(b){this.move("next",".ui-menu-item:first",b)},previous:function(b){this.move("prev",".ui-menu-item:last",b)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(e,d,c){if(!this.active){this.activate(c,this.element.children(d));return}var b=this.active[e+"All"](".ui-menu-item").eq(0);if(b.length){this.activate(c,b)}else{this.activate(c,this.element.children(d))}},nextPage:function(d){if(this.hasScroll()){if(!this.active||this.last()){this.activate(d,this.element.children(".ui-menu-item:first"));return}var e=this.active.offset().top,c=this.element.height(),b=this.element.children(".ui-menu-item").filter(function(){var f=a(this).offset().top-e-c+a(this).height();return f<10&&f>-10});if(!b.length){b=this.element.children(".ui-menu-item:last")}this.activate(d,b)}else{this.activate(d,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))}},previousPage:function(d){if(this.hasScroll()){if(!this.active||this.first()){this.activate(d,this.element.children(".ui-menu-item:last"));return}var e=this.active.offset().top,c=this.element.height(),b=this.element.children(".ui-menu-item").filter(function(){var f=a(this).offset().top-e+c-a(this).height();return f<10&&f>-10});if(!b.length){b=this.element.children(".ui-menu-item:first")}this.activate(d,b)}else{this.activate(d,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))}},hasScroll:function(){return this.element.height()<this.element[a.fn.prop?"prop":"attr"]("scrollHeight")},select:function(b){this._trigger("selected",b,{item:this.active})}})}(jQuery));(function(a){a.fn.joyride=function(b){var c={tipLocation:"bottom",scrollSpeed:300,timer:0,startTimerOnClick:false,nextButton:true,tipAnimation:"pop",tipAnimationFadeSpeed:300,cookieMonster:false,cookieName:"JoyRide",cookieDomain:false,tipContainer:"body",inline:false,tipContent:"#joyRideTipContent",postRideCallback:a.noop,postStepCallback:a.noop};var b=a.extend(c,b);return this.each(function(){if(a(b.tipContent).length===0){return}a(b.tipContent).hide();var k=a(b.tipContainer).children("*").first().position(),h=a(b.tipContent+" li"),l=skipCount=0,i=-1,g,j='<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>',n=function(q,p,r,o){return'<div class="joyride-tip-guide '+q+'" id="joyRidePopup'+p+'"><span class="joyride-nub"></span>'+a(o).html()+r+'<a href="#close" class="joyride-close-tip">X</a>'+g+"</div>"},m=function(q,p,r,o){if(p==0&&c.startTimerOnClick&&c.timer>0||c.timer==0){g=""}else{g=j}if(!q){q=""}(r!="")?r='<a href="#" class="joyride-next-tip small nice radius yellow button">'+r+"</a>":r="";if(c.inline){a(n(q,p,r,o)).insertAfter("#"+a(o).data("id"))}else{a(b.tipContainer).append(n(q,p,r,o))}};if(!c.cookieMonster||!a.cookie(c.cookieName)){h.each(function(q){var r=a(this).data("text"),p=a(this).attr("class"),o=this;if(c.nextButton&&r==undefined){r="Next"}if(c.nextButton||!c.nextButton&&c.startTimerOnClick){if(a(this).attr("class")){m(p,q,r,o)}else{m(false,q,r,o)}}else{if(!c.nextButton){if(a(this).attr("class")){m(p,q,"",o)}else{m(false,q,"",o)}}}a("#joyRidePopup"+q).hide()})}showNextTip=function(){var v=a(h[l]).data("id"),y=a("#"+v),o={};(a(h[l]).data("options")||":").split(";").map(function(z){var A=z.split(":");if(A.length==2){o[A[0].trim()]=A[1].trim()}});b=a.extend(b,o);c=a.extend(c,o);while(y.offset()===null){l++;skipCount++;((h.length-1)>i)?i++:i;v=a(h[l]).data("id"),y=a("#"+v);if(a(h).length<l){break}}var u=Math.ceil(a(window).height()/2),s=a("#joyRidePopup"+l),x=y.offset(),p=y.outerHeight(),w=s.outerHeight(),r=Math.ceil(a(".joyride-nub").outerHeight()/2),q=0;if(s.length===0){return}if(l<h.length){if(c.tipAnimation=="pop"){a(".joyride-timer-indicator").width(0);if(c.timer>0){s.show().children(".joyride-timer-indicator-wrap").children(".joyride-timer-indicator").animate({width:a(".joyride-timer-indicator-wrap").width()},c.timer)}else{s.show()}}else{if(c.tipAnimation=="fade"){a(".joyride-timer-indicator").width(0);if(c.timer>0){s.fadeIn(c.tipAnimationFadeSpeed).children(".joyride-timer-indicator-wrap").children(".joyride-timer-indicator").animate({width:a(".joyride-timer-indicator-wrap").width()},c.timer)}else{s.fadeIn(c.tipAnimationFadeSpeed)}}}if(c.tipLocation=="bottom"){s.offset({top:(x.top+p+r),left:(x.left-k.left)});s.children(".joyride-nub").addClass("top").removeClass("bottom")}else{if(c.tipLocation=="top"){if(w>=x.top){s.offset({top:((x.top+p+r)-k.top),left:(x.left-k.left)});s.children(".joyride-nub").addClass("top").removeClass("bottom")}else{s.offset({top:((x.top)-(w+k.top+r)),left:(x.left-k.left)});s.children(".joyride-nub").addClass("bottom").removeClass("top")}}}q=Math.ceil(s.offset().top-u);a("html, body").animate({scrollTop:q},c.scrollSpeed);if(l>0){if(skipCount>0){var t=i-skipCount;skipCount=0}else{var t=i}if(c.tipAnimation=="pop"){a("#joyRidePopup"+t).hide()}else{if(c.tipAnimation=="fade"){a("#joyRidePopup"+t).fadeOut(c.tipAnimationFadeSpeed)}}}}else{if((h.length-1)<l){if(skipCount>0){var t=i-skipCount;skipCount=0}else{var t=i}if(c.cookieMonster==true){a.cookie(c.cookieName,"ridden",{expires:365,domain:c.cookieDomain})}if(c.tipAnimation=="pop"){a("#joyRidePopup"+t).fadeTo(0,0)}else{if(c.tipAnimation=="fade"){a("#joyRidePopup"+t).fadeTo(c.tipAnimationFadeSpeed,0)}}}}l++;if(i<0){i=0}else{if((h.length-1)>i){i++}}if(c.postStepCallback!=a.noop){c.postStepCallback(i)}};if(!c.inline||!c.cookieMonster||!a.cookie(c.cookieName)){a(window).resize(function(){var s=a(h[i]).data("id"),p=a("#"+s).offset(),q=a("#"+s).outerHeight(),r=a("#joyRidePopup"+i).outerHeight(),o=Math.ceil(a(".joyride-nub").outerHeight()/2);if(c.tipLocation=="bottom"){a("#joyRidePopup"+i).offset({top:(p.top+q+o),left:p.left})}else{if(c.tipLocation=="top"){if(p.top<=r){a("#joyRidePopup"+i).offset({top:(p.top+o+q),left:p.left})}else{a("#joyRidePopup"+i).offset({top:((p.top)-(r+o)),left:p.left})}}}})}var e=null,d=false;if(!c.startTimerOnClick&&c.timer>0){showNextTip();e=setInterval(function(){showNextTip()},c.timer)}else{showNextTip()}var f=function(q,r,p,o){q.preventDefault();clearInterval(r);if(p){a.cookie(c.cookieName,"ridden",{expires:365,domain:c.cookieDomain})}a(o).parent().hide();if(c.postRideCallback!=a.noop){c.postRideCallback()}};a(".joyride-close-tip").click(function(o){f(o,e,c.cookieMonster,this)});a(".joyride-next-tip").click(function(o){o.preventDefault();if(l>=h.length){f(o,e,c.cookieMonster,this)}if(c.timer>0&&c.startTimerOnClick){showNextTip();clearInterval(e);e=setInterval(function(){showNextTip()},c.timer)}else{if(c.timer>0&&!c.startTimerOnClick){clearInterval(e);e=setInterval(function(){showNextTip()},c.timer)}else{showNextTip()}}})})};jQuery.cookie=function(e,f,c){if(arguments.length>1&&String(f)!=="[object Object]"){c=jQuery.extend({},c);if(f===null||f===undefined){c.expires=-1}if(typeof c.expires==="number"){var h=c.expires,d=c.expires=new Date();d.setDate(d.getDate()+h)}f=String(f);return(document.cookie=[encodeURIComponent(e),"=",c.raw?f:encodeURIComponent(f),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join(""))}c=f||{};var b,g=c.raw?function(i){return i}:decodeURIComponent;return(b=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?g(b[1]):null}})(jQuery);(function(b){var a={};b.publish=function(d,c){b.each(a[d],function(){if(typeof this.apply==="function"){this.apply(b,c||[])}})};b.subscribe=function(c,d){if(!a[c]){a[c]=[]}a[c].push(d);return[c,d]};b.unsubscribe=function(d){var c=d[0];a[c]&&b.each(a[c],function(e){if(this==d[1]){a[c].splice(e,1)}})}})(jQuery);jQuery(document).ready(function(b){function a(e){var d=e.closest("dl").find("a.active"),c=e.attr("href")+"Tab";d.removeClass("active");e.addClass("active");b(c).closest(".tabs-content").children("li").hide();b(c).css("display","block")}b("dl.tabs dd a").live("click",function(c){c.preventDefault();a(b(this))})});(function(){function addEvent(el,type,fn){if(el.addEventListener){el.addEventListener(type,fn,false)}else{if(el.attachEvent){el.attachEvent("on"+type,function(){fn.call(el)})}else{throw new Error("not supported or DOM not loaded")}}}function addResizeEvent(fn){var timeout;addEvent(window,"resize",function(){if(timeout){clearTimeout(timeout)}timeout=setTimeout(fn,100)})}if(document.documentElement.getBoundingClientRect){var getOffset=function(el){var box=el.getBoundingClientRect();var doc=el.ownerDocument;var body=doc.body;var docElem=doc.documentElement;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var zoom=1;if(body.getBoundingClientRect){var bound=body.getBoundingClientRect();zoom=(bound.right-bound.left)/body.clientWidth}if(zoom>1){clientTop=0;clientLeft=0}var top=box.top/zoom+(window.pageYOffset||docElem&&docElem.scrollTop/zoom||body.scrollTop/zoom)-clientTop,left=box.left/zoom+(window.pageXOffset||docElem&&docElem.scrollLeft/zoom||body.scrollLeft/zoom)-clientLeft;return{top:top,left:left}}}else{var getOffset=function(el){var top=0,left=0;do{top+=el.offsetTop||0;left+=el.offsetLeft||0;el=el.offsetParent}while(el);return{left:left,top:top}}}function getBox(el){var left,right,top,bottom;var offset=getOffset(el);left=offset.left;top=offset.top;right=left+el.offsetWidth;bottom=top+el.offsetHeight;return{left:left,right:right,top:top,bottom:bottom}}function addStyles(el,styles){for(var name in styles){if(styles.hasOwnProperty(name)){el.style[name]=styles[name]}}}function copyLayout(from,to){var box=getBox(from);addStyles(to,{position:"absolute",left:box.left+"px",top:box.top+"px",width:from.offsetWidth+"px",height:from.offsetHeight+"px"})}var toElement=(function(){var div=document.createElement("div");return function(html){div.innerHTML=html;var el=div.firstChild;return div.removeChild(el)}})();var getUID=(function(){var id=0;return function(){return"ValumsAjaxUpload"+id++}})();function fileFromPath(file){return file.replace(/.*(\/|\\)/,"")}function getExt(file){return(-1!==file.indexOf("."))?file.replace(/.*[.]/,""):""}function hasClass(el,name){var re=new RegExp("\\b"+name+"\\b");return re.test(el.className)}function addClass(el,name){if(!hasClass(el,name)){el.className+=" "+name}}function removeClass(el,name){var re=new RegExp("\\b"+name+"\\b");el.className=el.className.replace(re,"")}function removeNode(el){el.parentNode.removeChild(el)}window.AjaxUpload=function(button,options){this._settings={action:"upload.php",name:"userfile",multiple:false,data:{},autoSubmit:true,responseType:false,hoverClass:"hover",focusClass:"focus",disabledClass:"disabled",onChange:function(file,extension){},onSubmit:function(file,extension){},onComplete:function(file,response){}};for(var i in options){if(options.hasOwnProperty(i)){this._settings[i]=options[i]}}if(button.jquery){button=button[0]}else{if(typeof button=="string"){if(/^#.*/.test(button)){button=button.slice(1)}button=document.getElementById(button)}}if(!button||button.nodeType!==1){throw new Error("Please make sure that you're passing a valid element")}if(button.nodeName.toUpperCase()=="A"){addEvent(button,"click",function(e){if(e&&e.preventDefault){e.preventDefault()}else{if(window.event){window.event.returnValue=false}}})}this._button=button;this._input=null;this._disabled=false;this.enable();this._rerouteClicks()};AjaxUpload.prototype={setData:function(data){this._settings.data=data},disable:function(){addClass(this._button,this._settings.disabledClass);this._disabled=true;var nodeName=this._button.nodeName.toUpperCase();if(nodeName=="INPUT"||nodeName=="BUTTON"){this._button.setAttribute("disabled","disabled")}if(this._input){if(this._input.parentNode){this._input.parentNode.style.visibility="hidden"}}},enable:function(){removeClass(this._button,this._settings.disabledClass);this._button.removeAttribute("disabled");this._disabled=false},_createInput:function(){var self=this;var input=document.createElement("input");input.setAttribute("type","file");input.setAttribute("name",this._settings.name);if(this._settings.multiple){input.setAttribute("multiple","multiple")}addStyles(input,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"});var div=document.createElement("div");addStyles(div,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});if(div.style.opacity!=="0"){if(typeof(div.filters)=="undefined"){throw new Error("Opacity not supported by the browser")}div.style.filter="alpha(opacity=0)"}addEvent(input,"change",function(){if(!input||input.value===""){return}var file=fileFromPath(input.value);if(false===self._settings.onChange.call(self,file,getExt(file))){self._clearInput();return}if(self._settings.autoSubmit){self.submit()}});addEvent(input,"mouseover",function(){addClass(self._button,self._settings.hoverClass)});addEvent(input,"mouseout",function(){removeClass(self._button,self._settings.hoverClass);removeClass(self._button,self._settings.focusClass);if(input.parentNode){input.parentNode.style.visibility="hidden"}});addEvent(input,"focus",function(){addClass(self._button,self._settings.focusClass)});addEvent(input,"blur",function(){removeClass(self._button,self._settings.focusClass)});div.appendChild(input);document.body.appendChild(div);this._input=input},_clearInput:function(){if(!this._input){return}removeNode(this._input.parentNode);this._input=null;this._createInput();removeClass(this._button,this._settings.hoverClass);removeClass(this._button,this._settings.focusClass)},_rerouteClicks:function(){var self=this;addEvent(self._button,"mouseover",function(){if(self._disabled){return}if(!self._input){self._createInput()}var div=self._input.parentNode;copyLayout(self._button,div);div.style.visibility="visible"})},_createIframe:function(){var id=getUID();var iframe=toElement('<iframe src="javascript:false;" name="'+id+'" />');iframe.setAttribute("id",id);iframe.style.display="none";document.body.appendChild(iframe);return iframe},_createForm:function(iframe){var settings=this._settings;var form=toElement('<form method="post" enctype="multipart/form-data"></form>');form.setAttribute("action",settings.action);form.setAttribute("target",iframe.name);form.style.display="none";document.body.appendChild(form);for(var prop in settings.data){if(settings.data.hasOwnProperty(prop)){var el=document.createElement("input");el.setAttribute("type","hidden");el.setAttribute("name",prop);el.setAttribute("value",settings.data[prop]);form.appendChild(el)}}return form},_getResponse:function(iframe,file){var toDeleteFlag=false,self=this,settings=this._settings;addEvent(iframe,"load",function(){if(iframe.src=="javascript:'%3Chtml%3E%3C/html%3E';"||iframe.src=="javascript:'<html></html>';"){if(toDeleteFlag){setTimeout(function(){removeNode(iframe)},0)}return}var doc=iframe.contentDocument?iframe.contentDocument:window.frames[iframe.id].document;if(doc.readyState&&doc.readyState!="complete"){return}if(doc.body&&doc.body.innerHTML=="false"){return}var response;if(doc.XMLDocument){response=doc.XMLDocument}else{if(doc.body){response=doc.body.innerHTML;if(settings.responseType&&settings.responseType.toLowerCase()=="json"){if(doc.body.firstChild&&doc.body.firstChild.nodeName.toUpperCase()=="PRE"){response=doc.body.firstChild.firstChild.nodeValue}if(response){response=eval("("+response+")")}else{response={}}}}else{response=doc}}settings.onComplete.call(self,file,response);toDeleteFlag=true;iframe.src="javascript:'<html></html>';"})},submit:function(){var self=this,settings=this._settings;if(!this._input||this._input.value===""){return}var file=fileFromPath(this._input.value);if(false===settings.onSubmit.call(this,file,getExt(file))){this._clearInput();return}var iframe=this._createIframe();var form=this._createForm(iframe);removeNode(this._input.parentNode);removeClass(self._button,self._settings.hoverClass);removeClass(self._button,self._settings.focusClass);form.appendChild(this._input);form.submit();removeNode(form);form=null;removeNode(this._input);this._input=null;this._getResponse(iframe,file);this._createInput()}}})();(function(a){a.event.special.textchange={setup:function(c,b){a(this).bind("keyup.textchange",a.event.special.textchange.handler);a(this).bind("cut.textchange paste.textchange input.textchange",a.event.special.textchange.delayedHandler)},teardown:function(b){a(this).unbind(".textchange")},handler:function(b){a.event.special.textchange.triggerIfChanged(a(this))},delayedHandler:function(c){var b=a(this);setTimeout(function(){a.event.special.textchange.triggerIfChanged(b)},25)},triggerIfChanged:function(b){if(b.val()!==b.data("lastValue")){b.trigger("textchange",b.data("lastValue"));b.data("lastValue",b.val())}}};a.event.special.hastext={setup:function(d,c){var b=this;a(this).bind("textchange",a.event.special.hastext.handler)},teardown:function(b){a(this).unbind("textchange",a.event.special.hastext.handler)},handler:function(c,b){a.event.special.hastext.check(a(this),b)},check:function(c,b){if((b===""||b===undefined)&&b!==c.val()){c.trigger("hastext")}}};a.event.special.notext={setup:function(c,b){a(this).bind("textchange",a.event.special.notext.handler)},teardown:function(b){a(this).unbind("textchange",a.event.special.notext.handler)},handler:function(c,b){if(a(this).val()===""&&a(this).val()!==b){a(this).trigger("notext")}}}})(jQuery);ZURB.Notable.mixins.editableComment={clickEdit:function(a){a.preventDefault();this.$el.addClass("editing");this.$(".edit-actions textarea").focusAtEnd()},clickCancelEdit:function(a){a.preventDefault();this.stopEditing()},clickDelete:function(a){a.preventDefault();this.model.destroy();this.remove()},clickSaveEdit:function(a){a.preventDefault();this.model.save({body:this.$(".edit-actions textarea").val()});this.stopEditing()},stopEditing:function(){this.$el.removeClass("editing")},updateBody:function(b,a){this.$(".body-text").html(ZURB.Notable.format_breaks(a))}};ZURB.Notable.mixins.shareButtons={clickTwitterShare:function(a){a.preventDefault();window.open(a.currentTarget.href,"Twitter Share","height=450,width=600")},clickFacebookShare:function(a){a.preventDefault();window.open(a.currentTarget.href,"Facebook Share","height=450,width=600")}};ZURB.Notable.mixins.upgrade={clickPdfUpgrade:function(a){a.preventDefault();this.$("#pdfUpgrade").openModal()},clickSetsUpgrade:function(a){a.preventDefault();this.$("#setsUpgrade").openModal()},flipToUpgradeModal:function(a,f,e){var d=JST["accounts/upgrade"]({plan_name:a,url:f,hasPayPlan:ZURB.Notable.globals.hasPayPlan,nextBillDate:ZURB.Notable.globals.nextBillDate,redirectTo:location.href}),c=$(d),b=new ZURB.Notable.views.account.CreditCardForm({el:c});e.append(c);c.css({top:"700px"});$("#requestUpgrade").submit(_.bind(this.submitRequestUpgrade,this));e.find(".modal").animate({top:"-=1050px"},{queue:false})},clickPdfUpgradeButton:function(a){a.preventDefault();this.flipToUpgradeModal("Basic",this.model.get("pdf_upgrade_link"),$("#pdfUpgrade"))},clickSetsUpgradeButton:function(a){a.preventDefault();this.flipToUpgradeModal("Plus",this.model.get("sets_upgrade_link"),$("#setsUpgrade"))},submitRequestUpgrade:function(a){a.preventDefault();$(a.currentTarget).addClass("loading");$.ajax({url:"/upgrade_request",type:"POST",data:{message:$("#requestUpgrade textarea").val()},success:this.requestUpgradeSuccess})},requestUpgradeSuccess:function(a){$("#requestUpgrade").addClass("sent").removeClass("loading")}};ZURB.Notable.mixins.sharePermissions={clickRemoveUser:function(a){var b=$(a.currentTarget).closest("li");a.preventDefault();b.addClass("loading");$.ajax({url:a.currentTarget.href,type:"DELETE",data:{_method:"DELETE"},success:function(c){b.fadeOut()}})}};ZURB.Notable.views.organize.SetSelector=Backbone.View.extend({initialize:function(){_.bindAll(this,"changeWorkspacePicker","submitCreateSetForm");this.$el=$(this.el);this.$("#workspacePicker").live("change",this.changeWorkspacePicker);this.$("li.current").click(this.clickCurrentSet);$("#createSetForm").bind("submit",this.submitCreateSetForm);if(ZURB.Notable.globals.workspaceId){this.changeActiveWorkspace(ZURB.Notable.globals.workspaceId);$("#workspacePicker").val(ZURB.Notable.globals.workspaceId)}else{$("#workspacePicker").val(0)}$("#createWorkspace form").live("submit",function(){var a=$(this);$("button[type=submit]",a).addClass("disabled");$.ajax({url:"/workspaces",type:"POST",data:{workspace:{name:$("[name='workspace[name]']",a).val()}},success:function(d,b,e){d=JSON.parse(d);var c=$("<option>").attr("value",d.id).attr("selected","selected").text(d.name);var f='<li class="move" id="currentWorkspace" data-workspace-id="'+d.id+'" data-workspace-name="'+d.name+'" data-set-id="-1" data-new-workspace="true" style=""><a href="#"><span></span><h5>Move to '+d.name+"</h5></a></li>";$("#newSet").before(f);$("#workspacePicker option[value=new]").before(c).trigger("change");$("#createWorkspace").flipToModal("#movePost",{direction:"down"})},error:function(b){ZURB.Notable.displayNotification("error","Unable to create workspace")}});return false})},events:{"click li.dropdown a":"clickToggleDropdown","click li#newSet":"clickNewSet","click li.move":"clickMoveToSet","click #createWorkspace .cancel.button":"clickWorkspaceCancel","click #createSet .cancel.button":"clickNewSetCancel"},clickCurrentSet:function(a){a.stopPropagation();a.preventDefault();return false},clickToggleDropdown:function(a){a.preventDefault();$(a.currentTarget).closest("li.dropdown").toggleClass("open")},changeWorkspacePicker:function(a){this.changeActiveWorkspace($(a.currentTarget).val())},changeActiveWorkspace:function(a){var b=$("#moveToSets").siblings("h5");$("#moveToSets li").hide();$("#moveToSets li#newSet").show();$("#moveToSets li[data-workspace-id="+a+"]").show();if($("#moveToSets li:visible").length>0){b.show()}else{b.hide()}this.trigger("change-workspace",this.workspacePickerWorkspaceId())},clickNewSet:function(a){a.preventDefault();$(this.el).flipToModal("#createSet")},submitCreateSetForm:function(a){this.trigger("submit-create-set",a)},clickMoveToSet:function(a){this.trigger("click-set",a);this.$el.find(".close").trigger("click")},clickWorkspaceCancel:function(a){$("#createWorkspace").flipToModal("#movePost",{direction:"down"})},clickNewSetCancel:function(a){a.preventDefault();$("#createSet").flipToModal("#movePost",{direction:"down"})},selectedPostIdsCommaSeperated:function(){return _($("li.post.selected")).map(function(a){return $(a).data("post-id")}).join()},workspacePickerWorkspaceId:function(){var a=$("#workspacePicker option:checked").last().val();return(a==0)?"":a}});ZURB.Notable.models.Note=Backbone.Model.extend({defaults:{comments_count:0,position:0,avatar_url:"#",css_class:"selected",owner_name:"Me",comments:[],width:5,height:5,x_coordinate:10,y_coordinate:10,body:"",editable:true,comments_enabled:true,is_owner_note:true,created_time:""},initialize:function(){_.bindAll(this,"save");var a=new ZURB.Notable.collections.Comments();a.refresh(this.get("comments"));this.set({comments:a})},isValid:function(){return this.get("body")!==undefined&&this.get("body").length>0}});ZURB.Notable.models.Post=Backbone.Model.extend({urlBase:"/json/posts",initialize:function(a){this.bind("change:notes",this.updateNotesCollection);this.bind("change:comments",this.updateCommentsCollection);this.updateCommentsCollection();this.updateNotesCollection()},updateNotesCollection:function(){var a=new ZURB.Notable.collections.Notes();a.refresh(this.get("notes"));this.set({notes:a},{silent:true})},updateCommentsCollection:function(){var a=new ZURB.Notable.collections.PostComments();a.refresh(this.get("comments"));this.set({comments:a},{silent:true})},url:function(){return this.get("post_path")||Backbone.Model.prototype.url.call(this)},isPublished:function(){return !!this.get("published_at")},isFull:function(){return !this.isMinimal()},isMinimal:function(){return !!this.get("minimal")},ensureFull:function(a){this.fetch(a)}});ZURB.Notable.models.Comment=Backbone.Model.extend({defaults:{avatar_image_tag:""},initialize:function(){},urlBase:"/comments"});ZURB.Notable.models.PostComment=Backbone.Model.extend({defaults:{},initialize:function(){},urlBase:"/comments"});ZURB.Notable.models.NoteComment=Backbone.Model.extend({initialize:function(){},urlBase:"/note_comments"});ZURB.Notable.collections.Notes=Backbone.Collection.extend({model:ZURB.Notable.models.Note,url:"/notes",initialize:function(){this.bind("remove",this.updatePosition);this.bind("add",this.updatePosition)},updatePosition:function(){this.each(function(b,a){b.set({position:a+1})})}});ZURB.Notable.collections.PostVersions=Backbone.Collection.extend({url:"/posts",model:ZURB.Notable.models.Post,initialize:function(){},live_version:function(){return this.find(function(a){return a.get("is_live_version")})},other_versions:function(){return this.select(function(a){return !a.get("is_live_version")})},current_version:function(){return this.find(function(a){return a.get("is_current_version")})},has_unpublished:function(){return !!this.find(function(a){return !a.get("published_at")})}});ZURB.Notable.collections.Comments=Backbone.Collection.extend({url:"/note_comments",model:ZURB.Notable.models.Comment,initialize:function(){_.bindAll(this,"add")},comparator:function(a){return a.get("created_at")}});ZURB.Notable.collections.PostComments=Backbone.Collection.extend({url:"/post_comments",model:ZURB.Notable.models.Comment,initialize:function(){_.bindAll(this,"add")}});ZURB.Notable.views.dashboard.QuickView=Backbone.View.extend({template:JST["dashboards/quickviewloading"],className:"modal-wrapper ql-wrapper",initialize:function(){_.bindAll(this,"loaded");this.$el=$(this.el)},render:function(){if(!this.cached){this.cached=true;this.$el.html(this.template({}));$.get(this.url,{association_id:this.options.association_id},this.loaded)}return this},loaded:function(a){this.$el.html(a)},close:function(a){a.preventDefault();this.remove()}});ZURB.Notable.views.dashboard.PostQuickView=ZURB.Notable.views.dashboard.QuickView.extend({className:"modal-wrapper ql-wrapper",events:{"click a.close":"close","click .share input":"clickShareUrl","click .twitter-share":"clickTwitterShare","click .facebook-share":"clickFacebookShare"},url:"/dashboard/post",clickShareUrl:function(a){a.currentTarget.select()}}).extend(ZURB.Notable.mixins.shareButtons);ZURB.Notable.views.screenshot.Annotate=Backbone.View.extend({className:"fullscreen",events:{"click li.crop":"clickCrop","click .stop-crop":"clickStopCrop","click .undo-crop":"clickUndoCrop","click .dont-crop":"clickCrop"},initialize:function(){_.bindAll(this,"cropSuccess");this.$el=$(this.el)},render:function(){this.$el.empty();var b=new ZURB.Notable.views.screenshot.Header({model:this.model});this.$el.append(b.el);b.render();var a=new ZURB.Notable.views.screenshot.Screenshot({model:this.model,cachedScreenshot:this.cachedScreenshot});this.$el.append(a.render().el);if(this.model.get("set")){var c=new ZURB.Notable.views.screenshot.Switcher({model:this.model});this.$el.append(c.el);c.render()}return this},clickCrop:function(a){a.preventDefault();if(this.cropping){this.cropping=false;this.$el.removeClass("cropping");this.$(".cropper").remove()}else{this.cropping=true;this.$el.addClass("cropping");this.$(".annotate-content").append(JST["posts/screenshot/crop"]);this.makeCropDraggable();this.makeCropResizable()}},clickStopCrop:function(a){a.preventDefault();this.stopCropping()},stopCropping:function(){var a=this.$(".cropper");this.$el.addClass("crop-loading");this.$el.removeClass("cropping");$.ajax({url:this.model.url()+"/crop",type:"POST",data:{_method:"PUT",left:a.position().left,top:a.position().top,width:a.width(),height:a.height()},success:this.cropSuccess});this.$(".cropper").remove()},clickUndoCrop:function(a){a.preventDefault();this.$el.addClass("crop-loading");$.ajax({url:this.model.url()+"/undo_crop",type:"POST",data:{_method:"PUT"},success:this.cropSuccess})},cropSuccess:function(a){this.model.set(a);this.model.set({id:a.post_item.object_id});this.$el.removeClass("crop-loading");this.render()},makeCropDraggable:function(){this.$(".cropper").draggable({containment:"parent"})},makeCropResizable:function(){this.$(".cropper").resizable({handles:{ne:".top-right",nw:".top-left",se:".bottom-right",sw:".bottom-left"},containment:"parent"})}}).extend(ZURB.Notable.mixins.shareButtons);ZURB.Notable.views.screenshot.Header=Backbone.View.extend({template:JST["posts/screenshot/header"],events:{"click .people.dropdown li":"clickPerson","click .people .toggle-all":"clickToggleAll","click li.share":"clickShare","click .share input":"clickShareInput","click .twitter-share":"clickTwitterShare","click .facebook-share":"clickFacebookShare","click .close":"closeAnnotateView"},initialize:function(){_.bindAll(this,"changePostTitle","render");this.$el=$(this.el);this.model.bind("loaded",this.render)},render:function(){var b=this.model.toJSON();b.permissionsWithNotes=_(b.permissions).chain().reject(function(d){return d.note_count===0}).value();var a=this.model.get("notes").length;var c=(a===1)?"1 Note":a+" Notes";b.screenshot_notes_count_text=c;this.$el.html(this.template(b));if(this.model.get("owned")){$.editable(".post-title",{eventType:"mouseup",callback:this.changePostTitle,selectorContext:this.$el})}return this},clickShare:function(b){b.preventDefault();var a=new ZURB.Notable.views.share.Modal({model:this.model});this.$el.append(a.render().el);this.$("input.share")[0].focus()},changePostTitle:function(a){this.model.set({title:a});$.ajax({url:this.model.url()+"/update_title",type:"POST",data:{_method:"PUT",value:a}})},clickPerson:function(a){a.preventDefault();var b=$(a.currentTarget);if(b.hasClass("active")){}else{$(".people.dropdown .toggle-all").addClass("active")}$("div.note[data-user-id="+b.data("user-id")+"]").toggle();b.toggleClass("active")},clickToggleAll:function(a){a.preventDefault();$(a.currentTarget).toggleClass("active");if($(a.currentTarget).hasClass("active")){$(".people.dropdown li").addClass("active");$("div.note").show()}else{$("div.note").hide();$(".people.dropdown li").removeClass("active")}},clickShareInput:function(a){a.currentTarget.select()},closeAnnotateView:function(a){this.model.set({image_url:$("#screenshot").attr("src")})}}).extend(ZURB.Notable.mixins.shareButtons);ZURB.Notable.views.screenshot.Screenshot=Backbone.View.extend({className:"annotate-content",tagName:"section",events:{"click #screenshot":"click","mousedown #screenshot":"mousedown",mouseup:"mouseup",mousemove:"mousemove"},initialize:function(){_.bindAll(this,"click","addNote","render");this.$el=$(this.el);this.model.bind("loaded",this.render)},render:function(){var a=this.make("img",{id:"screenshot",screenshot_id:this.model.get("id"),width:this.model.get("width"),height:this.model.get("height"),src:this.options.cachedScreenshot||this.model.get("image_url")});$(this.el).css("width",this.model.get("width")+"px");$(this.el).html(a);$(this.el).append('<div class="crop-loading-overlay"></div>');if(!this.model.get("comments_enabled")){this.$el.unbind();this.$el.addClass("comments-disabled")}this.model.get("notes").each(function(b){this.appendNote(b)},this);return this},appendNote:function(c){var b=this.noteFactory(c),a=new b({model:c});this.$el.append(a.render().el);return a},click:function(a){a.preventDefault()},mousedown:function(a){a.preventDefault();this.dragging=true;this.addNoteAtEvent(a);this.startingPageX=a.pageX;this.startingPageY=a.pageY},mouseup:function(a){if(this.dragging){this.dragging=false;this.startingPageX=null;this.startingPageY=null;if(this.currentNoteView.isSmall()){if(this.$("div.note.active").length>0){$.publish("screenshot/notes/deactivate");this.currentNoteView.destroy()}else{this.currentNoteView.resizeToFixedBox();this.currentNoteView.$el.trigger("resizestop:after");this.currentNoteView.activate();this.currentNoteView.$el.removeClass("resizing");this.currentNoteView.startEditing()}}else{this.currentNoteView.$el.trigger("resizestop:after");this.currentNoteView.activate();this.currentNoteView.$el.removeClass("resizing");this.currentNoteView.startEditing()}}},mousemove:function(a){if(this.dragging){a.preventDefault();if(!this.currentNoteView.isSmall()){this.currentNoteView.$el.show()}if(a.pageX<this.startingPageX){this.currentNoteView.model.set({x_coordinate:a.pageX-this.$el.offset().left,width:this.startingPageX-a.pageX})}else{this.currentNoteView.model.set({x_coordinate:this.startingPageX-this.$el.offset().left,width:a.pageX-this.startingPageX})}if(a.pageY<this.startingPageY){this.currentNoteView.model.set({y_coordinate:a.pageY-this.$el.offset().top,height:this.startingPageY-a.pageY})}else{this.currentNoteView.model.set({y_coordinate:this.startingPageY-this.$el.offset().top,height:a.pageY-this.startingPageY})}}},addNoteAtEvent:function(a){this.addNote({x_coordinate:a.pageX-this.$el.offset().left,y_coordinate:a.pageY-this.$el.offset().top,post_id:this.model.get("id"),css_class:ZURB.Notable.globals.userCssColor,avatar_url:ZURB.Notable.globals.smallAvatarUrl})},addNote:function(a){var b=new ZURB.Notable.models.Note(a);this.model.get("notes").add(b);this.currentNoteView=this.appendNote(b);this.currentNoteView.$el.hide().addClass("resizing")},noteFactory:function(a){if(a.get("editable")){return ZURB.Notable.views.screenshot.EditableNote}else{return ZURB.Notable.views.screenshot.ReadOnlyNote}}});ZURB.Notable.views.screenshot.Note=Backbone.View.extend({template:JST["posts/screenshot/note"],className:"note",initialize:function(){_.bindAll(this,"deactivate","changePosition");this.$el=$(this.el);$.subscribe("screenshot/notes/deactivate",this.deactivate);this.model.bind("change:position",this.changePosition)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.attr("data-user-id",this.model.get("user_id"));this.noteBody=new ZURB.Notable.views.screenshot.NoteBody({model:this.model,screenshotNote:this});this.$el.attr("data-note-id",this.model.get("id"));this.$el.append(this.noteBody.render().el);this.position();return this},position:function(){this.$el.css({left:this.model.get("x_coordinate")+"px",top:this.model.get("y_coordinate")+"px",width:this.model.get("width")+"px",height:this.model.get("height")+"px",position:"absolute"})},deactivate:function(a){if(a!==this){this.$el.removeClass("active")}},changePosition:function(b,a){this.$(".black.note").html(a)}});ZURB.Notable.views.screenshot.EditableNote=ZURB.Notable.views.screenshot.Note.extend({events:{"click .overlay":"clickOverlay","click .delete-note":"destroy","click [data-cancel-note]":"cancelNote"},initialize:function(){this.subs=[];ZURB.Notable.views.screenshot.Note.prototype.initialize.call(this);_.bindAll(this,"deactivate","stopEditing","updateDimentions","updatePosition","render","activate","position","delayedSave","startSave","endSave","cancelDelayedSave");this.subs.push($.subscribe("screenshot/note/activated",this.deactivate));this.subs.push($.subscribe("screenshot/note/activated",this.stopEditing));this.subs.push($.subscribe("screenshot/notes/deactivate",this.stopEditing));this.bind("stopediting",this.stopEditing);this.bind("startediting",this.startEditing);this.bind("move",this.position);this.$el.bind("resizestart",this.cancelDelayedSave);this.$el.bind("resizestop",this.updatePosition);this.$el.bind("resizestop",this.updateDimentions);this.$el.bind("dragstop",this.updatePosition);this.$el.bind("dragstart",this.activate);this.$el.bind("dragstart",this.cancelDelayedSave);this.model.bind("change:width",this.position);this.model.bind("change:height",this.position);this.model.bind("change:width",this.delayedSave);this.model.bind("change:height",this.delayedSave);this.model.bind("change:x_coordinate",this.delayedSave);this.model.bind("change:y_coordinate",this.delayedSave);this.model.bind("change:body",this.delayedSave)},render:function(){ZURB.Notable.views.screenshot.Note.prototype.render.call(this);this.$el.addClass("editable");this.makeDraggable();this.makeResizable();return this},cancelNote:function(a){if(this.model.isNew()){this.destroy()}else{this.stopEditing()}},destroy:function(a){if(a){a.preventDefault()}if(!this.model.isNew()){this.model.destroy()}else{this.model.collection.remove(this.model)}this.remove();_.each(this.subs,function(b){$.unsubscribe(b)});this.subs=[];this.cancelDelayedSave()},cancelDelayedSave:function(){clearTimeout(this.savetimeout)},delayedSave:function(){if(this.model.isValid()){this.cancelDelayedSave();if(this.model.isNew()){this.startSave()}else{this.savetimeout=_.delay(this.startSave,1000)}}},startSave:function(){this.model.save(null,{success:this.endSave,silent:true});$("span.saving").show()},endSave:function(){$("span.saving").hide()},resizeToFixedBox:function(){this.model.set({width:100,height:100,x_coordinate:this.model.get("x_coordinate")-50,y_coordinate:this.model.get("y_coordinate")-50});this.trigger("move");this.$el.show()},clickOverlay:function(){this.activate();this.$("textarea").select()},startEditing:function(){this.$el.addClass("editing").removeClass("editable");this.noteBody.$("form.edit-note textarea").focusAtEnd()},stopEditing:function(a){if(a!==this){if(this.$el.hasClass("editing")){this.noteBody.saveNoteText();if(!this.model.isValid()){if(this.model.isNew()){this.destroy()}else{this.$el.addClass("invalid-body")}}else{this.$el.removeClass("editing invalid-body").addClass("editable")}}}},activate:function(){$.publish("screenshot/note/activated",[this]);this.$el.addClass("active")},isSmall:function(){return this.$el.width()<20&&this.$el.height()<20},updateDimentions:function(){this.model.set({width:this.$el.width(),height:this.$el.height()})},updatePosition:function(){this.model.set({x_coordinate:this.$el.position().left,y_coordinate:this.$el.position().top})},makeDraggable:function(){var a=this,b=this.$el;b.draggable({containment:"parent",handle:"div.overlay",start:function(c,d){b.addClass("dragging")},stop:function(c,d){b.removeClass("dragging");a.updated=true;b.trigger("dragstop:after",[c,d])}})},makeResizable:function(){var a=this,b=this.$el;b.resizable({handles:{ne:".top-right",se:".bottom-right",sw:".bottom-left",s:".bottom",n:".top",e:".right",w:".left"},containment:"parent",start:function(c,d){b.addClass("resizing")},stop:function(c,d){b.removeClass("resizing");a.updated=true;b.trigger("resizestop:after",[c,d])}})}});ZURB.Notable.views.screenshot.ReadOnlyNote=ZURB.Notable.views.screenshot.Note.extend({render:function(){ZURB.Notable.views.screenshot.Note.prototype.render.call(this);$(this.el).addClass("read-only");return this}});ZURB.Notable.views.screenshot.NoteBody=Backbone.View.extend({className:"global-note",template:JST["posts/screenshot/notebody"],windowPositionOffset:40,events:{"click form.edit-note button":"clickSaveNote","click a.edit-note":"startEditing","keypress form.edit-note textarea":"keypress","click a.show-comments":"showComments","click [data-cancel-comment]":"cancelComment","click form.add-note-comment button.save":"saveComment","keypress form.add-note-comment textarea":"keypressComment","select .note-comments textarea":"activateNote"},initialize:function(){var a=this;_.bindAll(this,"positionInWindow","position","render","appendComment","saveNoteTextError","stopEditing","saveCommentSuccess","activateNote","mouseenterNote","mouseleaveNote");$(this.options.screenshotNote.el).bind("mouseover dragstop:after resizestop:after",this.positionInWindow);$(this.options.screenshotNote.el).bind("resizestop:after",this.position);this.options.screenshotNote.bind("stopediting",this.stopEditing);this.model.bind("change:body",this.render);this.model.get("comments").bind("add",this.appendComment);$(this.options.screenshotNote.el).bind("mouseenter",a.mouseenterNote);$(this.options.screenshotNote.el).bind("mouseleave",a.mouseleaveNote);this.$el=$(this.el)},mouseleaveNoteTimeout:function(a){return setTimeout(function(){$(a).removeClass("hover")},750)},mouseenterNote:function(a){var b=$(a.currentTarget).data("mouseleaveNoteTimeout");if(typeof b!="undefined"){clearTimeout(b)}$(a.currentTarget).addClass("hover")},mouseleaveNote:function(a){var b=this.mouseleaveNoteTimeout($(a.currentTarget));$(a.currentTarget).data("mouseleaveNoteTimeout",b)},render:function(){$(this.el).html(this.template(this.model.toJSON()));this.position();this.positionInWindow();this.model.get("comments").each(function(b){var a=new ZURB.Notable.views.screenshot.Comment({model:b});this.$("div.note-comments ul").append(a.render().el)},this);this.$(".note-body, div.note-comments ul li .text").autoLink();return this},activateNote:function(a){this.options.screenshotNote.$el.addClass("active")},startEditing:function(a){a.preventDefault();this.options.screenshotNote.trigger("startediting")},appendComment:function(b){var a=new ZURB.Notable.views.screenshot.Comment({model:b});this.$("div.note-comments ul").append(a.render().el);this.$(".note-body, div.note-comments ul li .text").autoLink()},saveComment:function(a){a.preventDefault();this.$el.addClass("loading");var b=new ZURB.Notable.models.NoteComment({body:this.$("form.add-note-comment textarea").val(),note_id:this.model.get("id"),post_id:this.model.get("post_id")});b.save(null,{success:this.saveCommentSuccess});this.$("form.add-note-comment textarea").val("")},saveCommentSuccess:function(a){this.model.get("comments").add(a);this.$el.removeClass("loading")},clickSaveNote:function(a){a.preventDefault();this.options.screenshotNote.trigger("stopediting")},stopEditing:function(a){},showComments:function(a){a.preventDefault();this.$el.addClass("add-comment");this.$(".add-note-comment textarea").select()},cancelComment:function(a){a.preventDefault();this.$el.removeClass("add-comment");this.$(".add-note-comment textarea").select()},saveNoteText:function(){this.model.set({body:this.$("form.edit-note textarea").val()})},saveNoteTextError:function(b,a){alert(a)},keypress:function(a){if(!a.shiftKey&&a.which==13){a.preventDefault();this.options.screenshotNote.trigger("stopediting")}},keypressComment:function(a){if(!a.shiftKey&&a.which===13){this.saveComment(a)}},position:function(){$(this.el).css({top:this.model.get("height")+10+"px"})},positionInWindow:function(){var a=$(this.el),b=this.options.screenshotNote.$("span.nub"),c=this.options.screenshotNote.$(".border");if(this.noteBodyStartsInsideWindow()&&this.noteBodyEndsOutsideWindow()){a.css("left",$(window).width()-($(this.options.screenshotNote.el).offset().left+a.width()+this.windowPositionOffset));b.css("left",(c.width()/2)-7.5)}else{a.css("left",0);b.css("left",15)}},noteBodyEndsOutsideWindow:function(){var a=$(this.el);return($(this.options.screenshotNote.el).offset().left+a.width()+this.windowPositionOffset)>$(window).width()},noteBodyStartsInsideWindow:function(){return $(this.options.screenshotNote.el).offset().left<$(window).width()}});ZURB.Notable.views.screenshot.Comment=Backbone.View.extend({tagName:"li",template:JST["posts/screenshot/comment"],events:{"click a.edit-comment":"editComment","click div.edit-comment-actions .cancel":"editCancel","click div.edit-comment-actions .delete":"destroy","click div.edit-comment-actions button.save":"save","keypress div.edit-comment-actions textarea":"keypress"},initialize:function(){_.bindAll(this,"destroySuccess","saveSuccess","render");this.model.bind("change:body",this.render)},render:function(){$(this.el).html(this.template(this.model.toJSON()));this.textarea=this.$("div.edit-comment-actions textarea");return this},editComment:function(a){a.preventDefault();this.$(".edit-comment-actions").show();this.$(".note-comment").hide();this.textarea.focusAtEnd();$(this.el).closest(".note-comments").addClass("editing-comment")},editCancel:function(a){a.preventDefault();this.stopEditing()},keypress:function(a){if(a.which===13){this.save(a)}},save:function(a){a.preventDefault();this.model.save({body:this.textarea.val()},{success:this.saveSuccess})},saveSuccess:function(){this.stopEditing()},destroy:function(a){a.preventDefault();this.model.destroy({success:this.destroySuccess})},destroySuccess:function(){$(this.el).closest(".note-comments").removeClass("editing-comment");this.remove()},stopEditing:function(){this.$(".edit-comment-actions").hide();this.$(".note-comment").show();$(this.el).closest(".note-comments").removeClass("editing-comment")}});ZURB.Notable.views.screenshot.Switcher=Backbone.View.extend({template:JST["posts/screenshot/switcher"],className:"slim container",events:{"click li":"clickThumb","click .pan.right":"clickPanRight","click .pan.left":"clickPanLeft"},page:0,postsPerPage:6,initialize:function(){this.$el=$(this.el);_.bindAll(this,"setSelectedThumb");this.bind("pan",this.updateButtons);this.model.bind("loaded",this.setSelectedThumb)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.jumpToCurrentPage();this.updateButtons();return this},clickThumb:function(a){a.preventDefault();this.model.set({post_path:$(a.currentTarget).data("post-path")});this.model.fetch({success:function(b){b.trigger("loaded");$(window).scrollTop(0)}})},clickPanRight:function(a){a.preventDefault();if(!$(a.currentTarget).hasClass("disabled")){this.$("ul.set").animate({left:"-="+this.panOffset()});this.page+=1;this.trigger("pan")}},clickPanLeft:function(a){a.preventDefault();if(!$(a.currentTarget).hasClass("disabled")){this.$("ul.set").animate({left:"+="+this.panOffset()});this.page-=1;this.trigger("pan")}},panOffset:function(){return this.$("div.pan-mask").width()},updateButtons:function(){if(this.page==0){this.$(".pan.left").addClass("disabled")}else{this.$(".pan.left").removeClass("disabled")}if(!this.morePostsToShow()){this.$(".pan.right").addClass("disabled")}else{this.$(".pan.right").removeClass("disabled")}},morePostsToShow:function(){var a=this.model.get("set").posts.length;return((a-((this.page+1)*this.postsPerPage))>0)},setSelectedThumb:function(){this.$("li.current").removeClass("current");this.$("li[data-post-id="+this.model.get("id")+"]").addClass("current")},jumpToCurrentPage:function(){var a;_.each(this.model.get("set").posts,function(c,b){if(c.id==this.model.get("id")){a=b}},this);this.page=Math.floor(a/this.postsPerPage);this.$("ul.set").animate({left:"-="+this.panOffset()*this.page},0)}});ZURB.Notable.views.post.Post=Backbone.View.extend({template:JST["posts/post"],id:"post",initialize:function(){_.bindAll(this,"render","blockDuplicates","clickMoveTo","clickShare","clickAddVersion","clickAddVersionCancel","clickAddVersionFromPost","refreshAddVersionSelectPost","clickPdf","pdfReady","changePostTitle","changePostDescription");$(document).on("keydown",this.keydown);this.$el=$(this.el)},events:{"submit #versionUploadImageTab form":"blockDuplicates","click #moveTo":"clickMoveTo","click li.share":"clickShare","click li.version":"clickAddVersion","click li.export a.export":"clickPdf","click .export-pdf a.export.button":"loadPdf","click li.replace-image":"clickReplaceImage","click #addVersion .cancel":"clickAddVersionCancel","click #addVersion a.close":"clickAddVersionCancel","click #replaceImage a.cancel":"clickReplaceImageCancel","change #addVersion #versionSelectPostTab select":"refreshAddVersionSelectPost","change #addVersion #versionSelectPostTab select#workspacePicker":"changeWorkspacePicker","click #addVersion #versionSelectPostTab .posts a":"clickAddVersionFromPost","change #addVersion #newVersionFile":"changeUploadVersion","change #replaceImageFile":"selectReplacementImage","keydown textarea":"preventKeydownPropagation","keydown input":"preventKeydownPropagation","click .remove-user a":"clickRemoveUser"},render:function(){var b=this.model.toJSON();this.$el.html(this.template(b));this.collection.each(function(d){var c=new ZURB.Notable.views.post.PostVersion({model:d});this.$(".post-versions").append(c.render().el)});if(this.collection.has_unpublished()){this.$("li.version").hide()}if(this.model.get("owned")||this.model.get("account_admin")){$.editable(".post-title",{eventType:"mouseup",callback:this.changePostTitle,selectorContext:this.$el});$.editable(".description-text",{eventType:"mouseup",callback:this.changePostDescription,selectorContext:this.$el})}else{var a=$(".description-text").html().replace(/\n/g,"<br />");this.$(".description-text").html(a)}return this},preventKeydownPropagation:function(a){a.stopPropagation()},keydown:function(b){if(b.which===37){var a=$(".set-paddle.left").attr("href");if(typeof a==="string"){window.location=a}}else{if(b.which===39){var a=$(".set-paddle.right").attr("href");if(typeof a==="string"){window.location=a}}}},blockDuplicates:function(a){this.$('#versionUploadImageTab button[type="submit"]').addClass("disabled")},clickMoveTo:function(a){a.preventDefault();$("#movePost").openModal();if($("#movePost").find(".loading.modal").length>0){$.ajax({url:"/active_workspaces_and_sets",data:{id:this.model.get("id"),workspace_id:this.model.get("workspace_id")},type:"GET",success:function(b){$("#movePost").html(b);var c=new ZURB.Notable.views.organize.SetSelector({el:$("#movePost")});c.bind("change-workspace",function(e){var d=$('<input name="workspace_id" type="hidden" />');d.val(e);$("#createSetForm [name=workspace_id]").remove();$("#createSetForm").append(d)});c.trigger("change-workspace",ZURB.Notable.globals.workspaceId)}})}},clickShare:function(b){b.preventDefault();var a=new ZURB.Notable.views.share.Modal({model:this.model});this.$el.append(a.render().el);this.$("input.share")[0].focus()},changeWorkspacePicker:function(){this.$("#setPicker").value(null)},changeUploadVersion:function(a){if(a.target.value!==""){this.$('#addVersion #versionUploadImageTab button[type="submit"]').removeClass("disabled")}else{this.$('#addVersion #versionUploadImageTab button[type="submit"]').addClass("disabled")}},refreshAddVersionSelectPost:function(){$("#versionSelectPostTab").load("/posts/"+this.model.get("id")+"/add_version_select_post",$("#versionSelectPostTab form").serialize())},clickAddVersion:function(a){a.preventDefault();this.refreshAddVersionSelectPost();this.$("#addVersion").show()},clickAddVersionCancel:function(a){a.preventDefault();this.$("#addVersion").hide()},clickReplaceImageCancel:function(a){a.preventDefault();this.$("#replaceImage").hide()},selectReplacementImage:function(a){this.$("#replaceImage button:submit").removeClass("disabled")},clickAddVersionFromPost:function(b){b.preventDefault();var a=$(b.target).parents("li.post").attr("data-id");this.$("#versionSelectPostTab form #from_existing_id").val(a);this.$("#versionSelectPostTab form").submit()},clickPdf:function(a){a.preventDefault();$("#pdfUpgrade .not-sent").show();$("#pdfUpgrade .sent").hide();$("#pdfUpgrade").openModal()},loadPdf:function(b){var a="";b.preventDefault();if($("#exportWithComments")[0].checked){a="1"}$.ajax({url:this.model.url()+"/pdf?km_Export_PDF=Post&comments="+a});$("#pdfUpgrade .not-sent").hide();$("#pdfUpgrade .sent").show()},pdfReady:function(a){this.$(".export-pdf").removeClass("loading");$("#pdfUpgrade .close").trigger("click");if(a){window.location=a}},clickReplaceImage:function(b){var a=this.$("#replaceImage");b.preventDefault();a.find(".modal").css({top:$(window).scrollTop()+"px"});this.$("#replaceImage form").attr("action","/posts/"+$(b.target).data("post-version-id")+"/replace_image");a.show()},changePostTitle:function(a){this.model.set({title:a});$.ajax({url:this.model.url()+"/update_title",type:"POST",data:{_method:"PUT",value:a}})},changePostDescription:function(a){$.ajax({url:this.model.url()+"/update_description",type:"POST",data:{_method:"PUT",value:a}});this.model.set({description:a})}}).extend(ZURB.Notable.mixins.upgrade).extend(ZURB.Notable.mixins.sharePermissions);ZURB.Notable.views.post.PostVersion=Backbone.View.extend({tagName:"div",className:"post-version",template:JST["posts/post_version"],initialize:function(){_.bindAll(this,"render","commentAdded","commentSaved","updateCommentCount","closeAnnotate","hideExpanderForSmallImages","commentSaveErrorw");_.bindAll(this,"clickAddImage","clickAddPost","clickAddComment","submitAddPostForm","startUploading","finishUploading","addPostSuccess");_.bindAll(this,"clickExpandVersion","clickCollapseVersion");this.$el=$(this.el);this.bind_model_callbacks()},bind_model_callbacks:function(){if(this.model.get("comments")){this.model.get("comments").bind("add",this.commentAdded);this.model.get("comments").bind("add",this.updateCommentCount)}},events:{"click .expand-version":"clickExpandVersion","click .collapse-version":"clickCollapseVersion","click .comment-form button:submit, .image-uploader button:submit":"clickSubmitComment","submit #addPostForm":"submitAddPostForm","click .show-all-replies":"clickShowAllReplies","click .show-full-image a":"clickShowFull","click .comments-toggle a.on":"clickClosePost","click .comments-toggle a.off":"clickOpenPost","hover li.post-note":"highlightNote","hover .post-image .note":"highlightSidebarNote","click .tabs .tab-image":"clickAddImage","click .tabs .tab-post":"clickAddPost","click .tabs .tab-comment":"clickAddComment","mouseenter h4":"mouseEnterTitle","mouseleave h4":"mouseLeaveTitle"},render:function(){var a=this.model.toJSON();a.image_url=this.cachedScreenshot||a.image_url;a.default_height=this.defaultHeight();a.version_count=this.model.collection.size();this.$el.html(this.template(a));this.model.get("notes").each(function(c){if(c.id){var b=new ZURB.Notable.views.post.Note({model:c,post:this.model});this.$("ol.notes").append(b.render().el)}},this);this.model.get("comments").each(this.addComment,this);this.updateCommentCount();this.$(".open-annotate img").load(this.hideExpanderForSmallImages);if(this.$(".fileUploader").length>0){new AjaxUpload(this.$(".fileUploader"),{action:"/attachments",name:"uploaded_data",onSubmit:this.startUploading,onComplete:this.finishUploading,responseType:"json"})}return this},mouseEnterTitle:function(b){var a=this;this.optionsTimeout=setTimeout(function(){a.$(".action-flyout").show()},500)},mouseLeaveTitle:function(a){clearTimeout(this.optionsTimeout);this.$(".action-flyout").hide()},clickExpandVersion:function(a){a.preventDefault();this.$(".version-loading.spinner").show();clearTimeout(this.optionsTimeout);this.model.ensureFull({success:function(){this.bind_model_callbacks();this.render();this.$(".version-loading.spinner").hide()}.bind(this),error:function(){this.$(".version-loading.spinner").hide()}.bind(this)})},clickCollapseVersion:function(a){a.preventDefault();this.model.set({minimal:true});clearTimeout(this.optionsTimeout);this.render()},highlightNote:function(a){this.$("[data-note-id="+$(a.currentTarget).data("note-id")+"]").toggleClass("black yellow")},highlightSidebarNote:function(a){this.$("ol.notes [data-note-id="+$(a.currentTarget).data("note-id")+"] .note").toggleClass("black yellow")},defaultHeight:function(){return(this.bottomNote()&&this.bottomNote().get("preview_y")>445)?this.bottomNote().get("preview_y")+40:null},bottomNote:function(){var a=this.model.get("notes").first();this.model.get("notes").each(function(b){if(b.get("y_coordinate")>a.get("y_coordinate")){a=b}});return a},hideExpanderForSmallImages:function(){if(!this.model.get("comments_enabled")||this.$(".post-image").height()>this.$(".post-image img").height()){this.$("#postImageContainer").addClass("no-expander")}},clickSubmitComment:function(b){b.preventDefault();var a=$(b.currentTarget).closest("form");textarea=a.find("textarea"),comment=new ZURB.Notable.models.PostComment({attachment_id:a.find("input[name=attachment_id]").val(),body:textarea.val(),post_id:this.model.get("id")});comment.save({},{success:this.commentSaved,error:this.commentSaveError});a.addClass("loading");textarea.val("")},commentSaved:function(a){this.model.get("comments").add(a);this.$("form").removeClass("loading")},commentSaveError:function(a){this.$("form").removeClass("loading")},commentAdded:function(a){this.addComment(a)},addComment:function(b){var a=new ZURB.Notable.views.post.Comment({model:b});this.$(".replies").addClass("show-all");this.$(".replies").append(a.render().el)},clickShowAllReplies:function(a){a.preventDefault();this.$(".replies").toggleClass("show-all")},clickShowFull:function(a){a.preventDefault();this.$(".open-annotate").animate({height:this.$(".post-image img").height()});this.$(".show-full-image").hide();this.$(".post-image").addClass("expanded")},updateCommentCount:function(){var a=this.model.get("comments").size();this.$(".replies .comments-count").html(a+(a==1?" Comment":" Comments"))},clickClosePost:function(b){var c=$(b.currentTarget),a=c.closest(".comments-toggle");b.preventDefault();a.addClass("loading");$.ajax({url:this.model.url()+"/close",type:"POST",data:{_method:"PUT"},success:function(){c.addClass("off").removeClass("on");a.removeClass("loading");c.find("span.text").text("Off")}})},clickOpenPost:function(b){var c=$(b.currentTarget),a=c.closest(".comments-toggle");b.preventDefault();a.addClass("loading");$.ajax({url:this.model.url()+"/open",type:"POST",data:{_method:"PUT"},success:function(){c.addClass("on").removeClass("off");a.removeClass("loading");c.find("span.text").text("On")}})},clickAddImage:function(a){a.preventDefault();this.selectTab("tab-image")},clickAddComment:function(a){a.preventDefault();this.selectTab("tab-comment")},clickAddPost:function(a){a.preventDefault();this.selectTab("tab-post")},selectTab:function(a){this.$(".add-content").removeClass("tab-comment tab-post tab-image");this.$(".add-content").addClass(a);this.$(".add-content .tabs a").removeClass("active");this.$(".add-content .tabs ."+a).addClass("active")},startUploading:function(){this.$(".image-handling").addClass("loading").removeClass("loaded errors")},finishUploading:function(b,c){var a=this.$(".image-handling img");if(c.errors){$(".image-handling").removeClass("loading").addClass("errors")}else{a.load(function(){$(".image-handling").removeClass("loading").addClass("loaded");a.unbind()});a.attr("src",c.thumb_src);this.$(".image-uploader").prepend('<input type="hidden" name="attachment_id" value="'+c.id+'" />')}},submitAddPostForm:function(b){var c=this.$("#postURLInput").val(),a=$(b.currentTarget).removeClass("invalid not_found not_owner");b.preventDefault();if(match=c.match(/posts\/([a-z0-9]+)/i)){a.addClass("loading");$.ajax({url:"/posts/"+this.model.get("id")+"/add_post",type:"POST",data:{_method:"PUT",attached_post_id:match[1],body:$(b.currentTarget).find(".replying-textarea").val()},success:this.addPostSuccess})}else{a.addClass("invalid")}},addPostSuccess:function(b){var a=this.$("#addPostForm");a.removeClass("loading");if(b.error){a.addClass(b.error);message=b.message;if(message==undefined){message="Unable to add that post."}ZURB.Notable.displayNotification("error",message)}else{this.model.get("comments").add(b.comment);$("#addPostForm").trigger("reset")}}}).extend(ZURB.Notable.mixins.upgrade).extend(ZURB.Notable.mixins.sharePermissions);ZURB.Notable.views.post.Note=Backbone.View.extend({template:JST["posts/note"],tagName:"li",className:"post-note",events:{"keypress form textarea":"keypressTextarea","click .comment-count":"clickShowComments"},initialize:function(a){_.bindAll(this,"commentSaved","addComment","updateCommentCount","render","commentSaveError");this.$el=$(this.el);this.post=a.post;this.model.get("comments").bind("add",this.addComment);this.model.get("comments").bind("add",this.updateCommentCount);this.model.get("comments").bind("remove",this.updateCommentCount)},render:function(){templateAttributes=this.model.toJSON();templateAttributes.post=this.post;this.$el.html(this.template(templateAttributes));this.model.get("comments").chain().each(function(a){this.addComment(a)},this);if(this.$(".comment.new").length>0){this.$el.addClass("show-all")}this.$el.attr("data-note-id",this.model.get("id"));return this},keypressTextarea:function(b){if(b.which===13){b.preventDefault();var a=new ZURB.Notable.models.NoteComment({body:this.$(".add.comment textarea").val(),note_id:this.model.get("id"),post_id:this.post.get("id")});a.save({},{success:this.commentSaved,error:this.commentSaveError});this.$(".add.comment textarea").val("").select();this.$(".add.comment").addClass("loading")}},commentSaved:function(a){this.model.get("comments").add(a);this.$(".add.comment").removeClass("loading")},commentSaveError:function(a){this.$(".add.comment").removeClass("loading")},addComment:function(b){var a=new ZURB.Notable.views.post.NoteComment({model:b});this.$(".comment-position-holder").before(a.render().el)},updateCommentCount:function(){this.$("li.comment-count span.comments").html(this.model.get("comments").size())},clickShowComments:function(a){a.preventDefault();this.$el.toggleClass("show-all");this.$("textarea.input-text").select()}});ZURB.Notable.views.post.NoteComment=Backbone.View.extend({template:JST["posts/notecomment"],className:"comment",events:{"click .editable a":"clickEdit","click .cancel-edit":"clickCancelEdit","click .delete-edit":"clickDelete","click .save-edit":"clickSaveEdit"},initialize:function(){_.bindAll(this,"updateBody");this.$el=$(this.el);this.model.bind("change:body",this.updateBody)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.attr("class",this.className);if(this.model.get("new")){this.$el.addClass("new")}return this}}).extend(ZURB.Notable.mixins.editableComment);ZURB.Notable.views.post.Comment=Backbone.View.extend({template:JST["posts/comment"],className:"reply",events:{"click .editable a":"clickEdit","click .cancel-edit":"clickCancelEdit","click .delete-edit":"clickDelete","click .save-edit":"clickSaveEdit"},initialize:function(){_.bindAll(this,"updateBody");this.$el=$(this.el);this.model.bind("change:body",this.updateBody)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.attr("class",this.className);if(this.model.get("new")){this.$el.addClass("new")}return this}}).extend(ZURB.Notable.mixins.editableComment);ZURB.Notable.views.share.Modal=Backbone.View.extend({template:JST["share/modal"],id:"shareModal",className:"modal-wrapper",events:{"click .cancel":"clickCancel","click a.close":"clickCancel","click .share-remove":"clickShareRemove","click .share input":"clickShareInput","click .twitter-share":"clickTwitterShare","click .facebook-share":"clickFacebookShare","click #addPerson":"addUser","click .add-all-members":"clickAddAllUsers","change .share-list-with-info li :checkbox":"clickAddUser","keyup #userSearch":"filterList"},initialize:function(){_.bindAll(this,"select","shareKeypress");this.$el=$(this.el);this.bind("sharelistupdated",this.shareListUpdated)},render:function(){var a=this.model.toJSON();if(typeof this.options.path==="undefined"){a.path=ZURB.Notable.globals.permissionPath}else{a.path=this.options.path}this.$el.html(this.template(a));this.$("input.share").bind("keydown",this.shareKeypress);return this},filterList:function(){var b=$("#userSearch").val(),a=$(".share-list-with-info");a.children().each(function(){var d=$(this).data("email");var f=$(this).data("name");var c=d.toLowerCase().indexOf(b.toLowerCase());var e=f.toLowerCase().indexOf(b.toLowerCase());if(c!==-1||e!==-1||b==""){$(this).show()}else{$(this).hide()}})},shareKeypress:function(a){if(a.which===13){a.preventDefault();this.addUser()}},addUser:function(){var c=this.$("input.share"),b,a={name:null,avatar_url:ZURB.Notable.globals.defaultAvatarUrl,email:c.val(),id:null,css_class:"new"};b=_(this.model.get("addable_people")).chain().pluck("value").detect(function(d){return d.email==c.val()}).value();this.addUsertoShareList(b||a)},clickCancel:function(a){a.preventDefault();this.remove()},clickShareInput:function(a){a.preventDefault();a.currentTarget.select()},select:function(a,b){a.originalEvent.originalEvent.stopImmediatePropagation();a.preventDefault();this.addUsertoShareList(b.item.value)},addUsertoShareList:function(b){var a=this.$(".share-list-with-info li :checkbox[value='"+b.email+"']");if(a.length>0){a.trigger("click");this.$("input.share").val("")}else{this.$("input.share").removeClass("invalid");if(this.validateEmail(b.email)){this.$(".share-list-with-info").prepend(JST["share/modal-user"](b));this.$("input.share").val("")}else{this.$("input.share").addClass("invalid")}}this.trigger("sharelistupdated");$(".share-list-with-info").children().show()},clickShareRemove:function(a){a.preventDefault();$(a.currentTarget).closest("li").remove();this.trigger("sharelistupdated")},clickAddAllUsers:function(a){a.preventDefault();this.$(".share-list-with-info li :checkbox").attr("checked",true);this.trigger("sharelistupdated")},clickAddUser:function(h){this.trigger("sharelistupdated");var g=$(h.currentTarget).is(":checked");var f=$(h.currentTarget).closest("li");var a=this.$(".selected-users li");var b=$(":checkbox[checked=true]",a).last();var e=$(":checkbox",f.first()).val();var d=$(":checkbox",a.first()).val();var c=this;setTimeout(function(){if((g)&&(e!=d)){f.insertBefore(a.first())}else{if(!g&&(b.length>0)){b.closest("li").after(f)}else{if(e!=d){a.first().before(f)}}}if(g){c.$("#userSearch").val("").focus();c.filterList()}},500)},shareListUpdated:function(){var a=this.$(".selected-users li :checked");if(a.length>0){this.$(".button:submit").removeClass("disabled");this.$(".selected-users").removeClass("empty")}else{this.$(".button:submit").addClass("disabled");this.$(".selected-users").addClass("empty")}},validateEmail:function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return a.match(b)}}).extend(ZURB.Notable.mixins.shareButtons);ZURB.Notable.controllers.Post=Backbone.Controller.extend({routes:{"annotate/:version_id":"annotate_version","annotate/:version_id/note/:note_id":"annotate_version",annotate:"annotate","annotate/note/:note_id":"annotate","":"show"},initialize:function(a){this.collection=new ZURB.Notable.collections.PostVersions(a.collection);this.post_view=new ZURB.Notable.views.post.Post({model:this.collection.live_version(),collection:this.collection})},show:function(){$("body").removeClass("annotating");if(this.annotate_view){this.annotate_view.$el.detach()}$(".platform-bar").show();$("footer").show();$("#footerLogo").show();$("#contentTarget").html(this.post_view.el);this.post_view.render()},annotate_version:function(d,c){var a=this;var b=this.collection.get(d);var e=function(){a.annotate_view=new ZURB.Notable.views.screenshot.Annotate({model:b});a.post_view.$el.detach();$(".platform-bar").hide();$("footer").hide();$("#footerLogo").hide();$("body").addClass("annotating");$("#contentTarget").html(a.annotate_view.el);a.annotate_view.render();if(c){var f=$("[data-note-id="+c+"]");if(f.length>0){$(window).scrollTop(f.position().top);f.addClass("active");f.closest(".note").find(".show-comments").trigger("click")}}};if(this.collection.current_version().get("id")===d){e()}else{b.ensureFull({success:e})}},annotate:function(a){return this.annotate_version(this.collection.current_version().get("id"))}});ZURB.Notable.views.account.Modal=Backbone.View.extend({className:"modal-wrapper ql-wrapper",initialize:function(){_.bindAll(this,"submitRequestUpgrade","requestUpgradeSuccess");this.$el=$(this.el)},render:function(){var a=JST["accounts/"+this.model.action];this.$el.html(a(this.model));this.$el.openModal();this.$("#requestUpgrade").submit(this.submitRequestUpgrade);return this}}).extend(ZURB.Notable.mixins.upgrade);ZURB.Notable.views.account.CreditCardForm=Backbone.View.extend({initialize:function(){_.bindAll(this,"submitForm");this.$el=$(this.el);this.$el.bind("submit",this.submitForm)},submitForm:function(f){this.hasErrors=false;var d=this.$('[name="credit_card[first_name]"]'),b=this.$('[name="credit_card[last_name]"]'),e=this.$('[name="credit_card[number]"]'),a=this.$('[name="credit_card[verification_value]"]'),g=this.$('[name="credit_card[month]"]'),c=this.$('[name="credit_card[year]"]');this.$("input").removeClass("blank invalid");this.checkForBlank(d);this.checkForBlank(b);this.checkForBlank(e);this.checkForNumber(e);this.checkForBlank(a);this.checkForNumber(a);this.checkForBlank(g);this.checkForNumber(g);if(parseInt(g.val(),10)<1||parseInt(g.val(),10)>12){this.hasErrors=true;g.addClass("invalid")}this.checkForBlank(c);this.checkForNumber(c);if(parseInt(c.val(),10)<(new Date()).getFullYear()||parseInt(c.val(),10)>10000){this.hasErrors=true;c.addClass("invalid")}if(this.hasErrors&&e.length>0){f.preventDefault()}else{this.$("button[type=submit]").attr("disabled","disabled").addClass("disabled")}},checkForBlank:function(a){if(a.length>0&&a.val().length===0){this.hasErrors=true;a.addClass("blank")}},checkForNumber:function(a){if(isNaN(parseInt(a.val(),10))){this.hasErrors=true;a.addClass("invalid")}}});ZURB.Notable.views.post.FileDropPlaceholder=Backbone.View.extend({tagName:"li",className:"uploading set",template:JST["posts/file_drop_placeholder"],initialize:function(){_.bindAll(this,"render");this.post_ids=[];this.file_drop=this.options.file_drop;this.files=this.options.files;this.file=this.options.file},render:function(){$(this.el).html(this.template({files:this.files,file:this.file}));if(this.files){$(this.el).addClass("set")}else{$(this.el).addClass("post")}return this}});ZURB.Notable.views.post.FileDrop=Backbone.View.extend({initialize:function(){_.bindAll(this,"render","add_placeholders","upload_started","upload_finished","all_finished","fill_placeholder");this.post_ids=[];this.placeholders=[];this.placeholder_type=this.options.placeholder_type;this.container=this.options.container;this.files=this.options.files},render:function(){return this},group_in_set:function(){return this.files.length>1&&this.container.can_create_sets&&!this.container.set_id},add_placeholders:function(){if(this.container.post_id){return}if(this.group_in_set()){this.placeholders.push(new ZURB.Notable.views.post.FileDropPlaceholder({file_drop:this,files:this.files}).render())}else{$("#emptySetMessage").hide();$("#emptyWorkspaceMessage").hide();_.each(this.files,function(a){if(this.placeholder_type=="list"){this.placeholders.push(new ZURB.Notable.views.post.ListViewPlaceholder({file_drop:this,file:a}).render())}else{this.placeholders.push(new ZURB.Notable.views.post.FileDropPlaceholder({file_drop:this,file:a}).render())}},this)}_.each(this.placeholders,function(a){if(this.container.set_id){$(this.container.el).find(".th-grid").append(a.el)}else{$(this.container.el).find(".th-grid").prepend(a.el)}},this);return this},upload_started:function(c,b,a){},upload_finished:function(c,b,a,d){this.post_ids.push(a.id)},all_finished:function(a){if(this.group_in_set()){$.post("/sets.json",{"set[name]":"New Set",post_ids:this.post_ids.join(","),workspace_id:this.container.workspace_id},$.proxy(function(b){this.fill_placeholder(0,{set_id:b.id});a()},this))}else{_.each(this.post_ids,function(b,c){this.fill_placeholder(c,{post_id:b})},this);a()}},fill_placeholder:function(b,a){var c="";if(this.placeholder_type){c="?placeholder_type="+this.placeholder_type}$.get("/dashboard_items/tile"+c,a,$.proxy(function(d){$(this.placeholders[b].el).replaceWith(d)},this))}});ZURB.Notable.views.post.VersionFileDrop=ZURB.Notable.views.post.FileDrop.extend({add_placeholders:function(){return this},upload_started:function(c,b,a){$("body").addClass("filedrop-uploading")},upload_finished:function(d,c,a,e){var b=a.id;$.post("/posts/"+this.container.post_id+"/add_version",{from_existing_id:b},function(f){$("body").removeClass("filedrop-uploading");window.location="/posts/"+this.container.post_id}.bind(this))},all_finished:function(){}});ZURB.Notable.views.post.FileDropContainer=Backbone.View.extend({allowed_file_types:["image/jpg","image/jpeg","image/png","image/gif"],max_files:25,max_file_size_mb:20,initialize:function(){_.bindAll(this,"render","drag_over","drag_leave","drop","upload_started","upload_finished","drop_error","after_all");this.workspace_id=this.options.workspace_id;this.set_id=this.options.set_id;this.post_id=this.options.post_id;this.placeholder_type=this.options.placeholder_type;this.can_create_posts=this.options.can_create_posts;this.can_create_sets=this.options.can_create_sets;this.can_create_versions=this.options.can_create_versions;this.locked=false;this.initialize_filedrop()},initialize_filedrop:function(){$(this.el).filedrop({url:"/posts.json",paramname:"post[file]",data:{upload_type:"single","post[workspace_id]":this.workspace_id,"post[set_id]":this.set_id},error:this.drop_error,allowedfiletypes:this.allowed_file_types,maxfiles:this.max_files,maxfilesize:this.max_file_size_mb,dragOver:this.drag_over,drop:this.drop,uploadStarted:this.upload_started,uploadFinished:this.upload_finished,afterAll:this.after_all})},drag_over:function(a){$(this.el).addClass("filedrop-hover");if(!this.post_id&&!this.can_create_posts){$(this.el).addClass("filedrop-forbidden")}if(this.post_id&&!this.can_create_versions){$(this.el).addClass("filedrop-forbidden")}if(!this.post_id&&this.can_create_sets&&!this.set_id){$(this.el).addClass("filedrop-sets")}clearTimeout(this.delayDragLeave);this.delayDragLeave=setTimeout(this.drag_leave,100)},drag_leave:function(a){$(this.el).removeClass("filedrop-hover");$(this.el).removeClass("filedrop-forbidden");$(this.el).removeClass("filedrop-sets")},upload_started:function(c,b,a){this.current_file_drop.upload_started(c,b,a)},upload_finished:function(c,b,a,d){this.current_file_drop.upload_finished(c,b,a,d)},after_all:function(){this.current_file_drop.all_finished(function(){$("body").removeClass("filedrop-in-progress");this.locked=false}.bind(this))},drop:function(b){var a=b.dataTransfer.files;if(!this.post_id&&!this.can_create_posts){alert("Sorry, but you aren't allowed to create a post here.");return false}if(this.post_id){if(this.can_create_versions){if(a.length>1){alert("Sorry, but only one file can be dropped to create a version.");return false}if(!this.locked){this.locked=true;this.current_file_drop=new ZURB.Notable.views.post.VersionFileDrop({container:this,files:a}).render().add_placeholders()}else{return false}}else{return false}}else{if(!this.locked){this.locked=true;this.current_file_drop=new ZURB.Notable.views.post.FileDrop({container:this,files:a,placeholder_type:this.placeholder_type}).render().add_placeholders();$("body").addClass("filedrop-in-progress")}else{return false}$(this.el).removeClass("filedrop-hover")}},drop_error:function(b,a){switch(b){case"BrowserNotSupported":alert("Browser does not support html5 drag and drop");break;case"TooManyFiles":alert("Sorry, but you tried to upload too many files at once.");break;case"FileTooLarge":alert("The file "+a.name+" was too large.");break;case"FileTypeNotAllowed":alert("Sorry, but you are not allowed to upload this file type.");default:break}}});